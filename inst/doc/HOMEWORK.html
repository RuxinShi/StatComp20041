<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Ruxin Shi" />

<meta name="date" content="2020-12-21" />

<title>HOMEWORK</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>
<style type="text/css">
a.anchor-section {margin-left: 10px; visibility: hidden; color: inherit;}
a.anchor-section::before {content: '#';}
.hasAnchor:hover a.anchor-section {visibility: visible;}
</style>
<script>// Anchor sections v1.0 written by Atsushi Yasumoto on Oct 3rd, 2020.
document.addEventListener('DOMContentLoaded', function() {
  // Do nothing if AnchorJS is used
  if (typeof window.anchors === 'object' && anchors.hasOwnProperty('hasAnchorJSLink')) {
    return;
  }

  const h = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

  // Do nothing if sections are already anchored
  if (Array.from(h).some(x => x.classList.contains('hasAnchor'))) {
    return null;
  }

  // Use section id when pandoc runs with --section-divs
  const section_id = function(x) {
    return ((x.classList.contains('section') || (x.tagName === 'SECTION'))
            ? x.id : '');
  };

  // Add anchors
  h.forEach(function(x) {
    const id = x.id || section_id(x.parentElement);
    if (id === '') {
      return null;
    }
    let anchor = document.createElement('a');
    anchor.href = '#' + id;
    anchor.classList = ['anchor-section'];
    x.classList.add('hasAnchor');
    x.appendChild(anchor);
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">HOMEWORK</h1>
<h4 class="author">Ruxin Shi</h4>
<h4 class="date">2020-12-21</h4>



<div id="homewoek-1" class="section level1">
<h1>HOMEWOEK 1</h1>
<div id="qestion" class="section level2">
<h2>Qestion</h2>
<p>Use knitr to produce 3 examples.<br />
1.Contain texts and at least one figure.<br />
2.Contain texts and at least one table.<br />
3.Contain at least a couple of LaTex formulas.</p>
</div>
<div id="answer" class="section level2">
<h2>Answer</h2>
<div id="q1" class="section level3">
<h3>Q1</h3>
<p>Here I choose to generate some random numbers and picture their distribution.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>A=<span class="kw">rnorm</span>(<span class="dv">1000</span>,<span class="dt">mean=</span><span class="dv">5</span>,<span class="dt">sd=</span><span class="dv">2</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">hist</span>(A)  </span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="q2" class="section level3">
<h3>Q2</h3>
<p>Here I use a table to show these random numbers’ mean and standard deviation.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>T=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">colnames</span>(T)=<span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;sd&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">rownames</span>(T)=<span class="kw">c</span>(<span class="st">&quot;expect&quot;</span>,<span class="st">&quot;real&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>T[<span class="dv">1</span>,]=<span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">2</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>T[<span class="dv">2</span>,]=<span class="kw">c</span>(<span class="kw">mean</span>(A),<span class="kw">sd</span>(A))</span>
<span id="cb2-6"><a href="#cb2-6"></a>knitr<span class="op">::</span><span class="kw">kable</span>(T,<span class="dt">digits=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>),<span class="dt">align=</span><span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">mean</th>
<th align="center">sd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">expect</td>
<td align="center">5.000</td>
<td align="center">2.000</td>
</tr>
<tr class="even">
<td align="left">real</td>
<td align="center">5.027</td>
<td align="center">2.045</td>
</tr>
</tbody>
</table>
</div>
<div id="q3" class="section level3">
<h3>Q3</h3>
<p>Here I show some formulas.<br />
<span class="math display">\[\mathbf{Y}_{it}=\beta_0+\mathbf{Z}_i^T\gamma+\beta_1\]</span><br />
<span class="math display">\[\sigma_{it}^2=\alpha_0+\alpha_{1}\frac{1}{n_i}\sum^N_{j=1}a_{ij}e_{i(t-1)}^2+\alpha_2e_{i(t-1)}^2\]</span><br />
<span class="math display">\[\mathbf{W} =
    \begin{pmatrix}
        \frac{1}{n_1}&amp;&amp;&amp;\\
        &amp;\frac{1}{n_2}&amp;&amp;\\
        &amp;&amp;\ddots&amp;\\
        &amp;&amp;&amp;\frac{1}{n_N}\\
    \end{pmatrix}
    \begin{pmatrix}
        a_{11} &amp; a_{12} &amp; \cdots &amp; a_{1N}\\
        a_{21} &amp; a_{22} &amp; \cdots &amp; a_{2N}\\
        \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
        a_{N1} &amp; a_{N2} &amp; \cdots &amp; a_{NN},\\
    \end{pmatrix}\]</span></p>
</div>
<div id="thanks-for-your-viewing." class="section level3">
<h3>Thanks for your viewing.</h3>
</div>
<div id="have-a-good-day" class="section level3">
<h3>Have a good day!</h3>
</div>
</div>
</div>
<div id="homework-2" class="section level1">
<h1>HOMEWORK 2</h1>
<div id="section" class="section level2">
<h2>5.1</h2>
<p>Compute a Monte Carlo estimate of <span class="math display">\[\int_0^\frac{\pi}{3}\sin t dt\]</span> and compare your estimate with the exact value of the integral.</p>
<div id="solution" class="section level3">
<h3>Solution</h3>
<p>Here <span class="math inline">\(\int_0^\frac{\pi}{3}\sin t dt=\int_0^\frac{\pi}{3}\frac{\pi}{3}\sin x \frac{3}{\pi}dx=E[\frac{\pi}{3}\sin U]\)</span>, where <span class="math inline">\(U\sim U(0,\frac{\pi}{3})\)</span>. So we just need to generate large numbers of <span class="math inline">\(X=\frac{\pi}{3}\sin U\)</span>, and calculate their mean, then we will get the value we want.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>n=<span class="dv">3000</span><span class="co">#The number of X we choose to generate.</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>U=<span class="kw">runif</span>(n,<span class="dt">min=</span><span class="dv">0</span>,<span class="dt">max=</span>pi<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>X=pi<span class="op">/</span><span class="dv">3</span><span class="op">*</span><span class="kw">sin</span>(U)<span class="co">#get X</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>E=<span class="kw">mean</span>(X)<span class="co">#the mean of X, which is also the value we want</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>realE=<span class="fl">0.5</span><span class="co">#the real value</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="st">&quot;right&quot;</span>,<span class="st">&quot;estimate&quot;</span>,<span class="st">&quot;difference&quot;</span>),<span class="kw">c</span>(realE,E,<span class="kw">abs</span>(realE<span class="op">-</span>E)))<span class="co">#compare</span></span></code></pre></div>
<pre><code>##      [,1]    [,2]                [,3]                 
## [1,] &quot;right&quot; &quot;estimate&quot;          &quot;difference&quot;         
## [2,] &quot;0.5&quot;   &quot;0.495995456762028&quot; &quot;0.00400454323797161&quot;</code></pre>
</div>
</div>
<div id="section-1" class="section level2">
<h2>5.7</h2>
<p>Refer to Exercise 5.6. Use a Monte Carlo simulation to estimate <span class="math inline">\(\theta\)</span> by the antithetic variate approach and by the simple Monte Carlo method. Compute an empirical estimate of the percent reduction in variance using the antithetic variate. Compare the result with the theoretical value from the Exercise 5.6.</p>
<div id="solution-1" class="section level3">
<h3>Solution</h3>
<p>First we estimate <span class="math inline">\(\theta\)</span> by the simple Monte Carlo method. Similarly as 5.1, <span class="math inline">\(\theta=\int_0^1e^x dx=E[e^U]\)</span>, where <span class="math inline">\(U\sim U(0,1)\)</span>. So we just need to generate enough numbers of <span class="math inline">\(X=e^U\)</span> and calculate their mean, then we will get the value we want.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">set.seed</span>(<span class="dv">726</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>n=<span class="dv">3000</span><span class="co">#The number of X we choose to generate.</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>U=<span class="kw">runif</span>(n,<span class="dt">min=</span><span class="dv">0</span>,<span class="dt">max=</span><span class="dv">1</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>X=<span class="kw">exp</span>(U)<span class="co">#get X</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>E1=<span class="kw">mean</span>(X)<span class="co">#the mean of X, which is also the value we want</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>realE=<span class="kw">exp</span>(<span class="dv">1</span>)<span class="op">-</span><span class="dv">1</span><span class="co">#the real value</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="st">&quot;right&quot;</span>,<span class="st">&quot;estimate&quot;</span>,<span class="st">&quot;difference&quot;</span>),<span class="kw">c</span>(realE,E1,<span class="kw">abs</span>(realE<span class="op">-</span>E1)))<span class="co">#compare</span></span></code></pre></div>
<pre><code>##      [,1]               [,2]               [,3]                
## [1,] &quot;right&quot;            &quot;estimate&quot;         &quot;difference&quot;        
## [2,] &quot;1.71828182845905&quot; &quot;1.70617159085941&quot; &quot;0.0121102375996365&quot;</code></pre>
<p>Then we use the antithetic variate approach to estimate <span class="math inline">\(\theta\)</span>. Because <span class="math inline">\(\theta=\int_0^1e^x dx=\int_1^0e^{1-x}d(1-x)=\int_0^1e^{1-x}dx\)</span>, so <span class="math inline">\(E[e^{1-U}]\)</span> can also used to estimate <span class="math inline">\(\theta\)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>n=<span class="dv">1500</span><span class="co">#The number of X we choose to generate.</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">set.seed</span>(<span class="dv">112</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>U=<span class="kw">runif</span>(n,<span class="dt">min=</span><span class="dv">0</span>,<span class="dt">max=</span><span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a>X1=<span class="kw">exp</span>(U)<span class="co">#get X</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>X2=<span class="kw">exp</span>(<span class="dv">1</span><span class="op">-</span>U)</span>
<span id="cb7-6"><a href="#cb7-6"></a>X=(X1<span class="op">+</span>X2)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>E2=<span class="kw">mean</span>(X)<span class="co">#the mean of X, which is also the value we want</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>realE=<span class="kw">exp</span>(<span class="dv">1</span>)<span class="op">-</span><span class="dv">1</span><span class="co">#the real value</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="st">&quot;right&quot;</span>,<span class="st">&quot;estimate&quot;</span>,<span class="st">&quot;difference&quot;</span>),<span class="kw">c</span>(realE,E2,<span class="kw">abs</span>(realE<span class="op">-</span>E2)))<span class="co">#compare</span></span></code></pre></div>
<pre><code>##      [,1]               [,2]               [,3]                  
## [1,] &quot;right&quot;            &quot;estimate&quot;         &quot;difference&quot;          
## [2,] &quot;1.71828182845905&quot; &quot;1.71798971568698&quot; &quot;0.000292112772068309&quot;</code></pre>
<p>We can see that the differences shows the second method has much less difference than the real value, which seems a better method. Now we compare these two methods and compute the empirical estimate of the percent reduction.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>n=<span class="dv">3000</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>V=<span class="ot">NULL</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>){</span>
<span id="cb9-4"><a href="#cb9-4"></a>  Var2=Var1=<span class="dv">0</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  U=<span class="kw">runif</span>(n,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a>  X1=<span class="kw">exp</span>(U)<span class="co">#simple Monte Carlo method</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  X2=(<span class="kw">exp</span>(U[<span class="dv">1</span><span class="op">:</span>(n<span class="op">/</span><span class="dv">2</span>)])<span class="op">+</span><span class="kw">exp</span>(<span class="dv">1</span><span class="op">-</span>U[<span class="dv">1</span><span class="op">:</span>(n<span class="op">/</span><span class="dv">2</span>)]))<span class="op">/</span><span class="dv">2</span><span class="co">#antithetic variate approach</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  Var1=<span class="kw">var</span>(X1)</span>
<span id="cb9-9"><a href="#cb9-9"></a>  Var2=<span class="kw">var</span>(X2)</span>
<span id="cb9-10"><a href="#cb9-10"></a>  V[i]=Var2<span class="op">/</span>Var1</span>
<span id="cb9-11"><a href="#cb9-11"></a>}</span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="kw">mean</span>(V)</span></code></pre></div>
<pre><code>## [1] 0.01615672</code></pre>
<p>This result has verified that antithetic variate approach use less samples and get less variance.</p>
</div>
</div>
<div id="section-2" class="section level2">
<h2>5.11</h2>
<p>If <span class="math inline">\(\hat{\theta_1}\)</span> and <span class="math inline">\(\hat{\theta_2}\)</span> are unbiased estimators of <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(\hat{\theta_1}\)</span> and <span class="math inline">\(\hat{\theta_2}\)</span> are antithetic, we derived that <span class="math inline">\(c^{\star}=\frac{1}{2}\)</span> is the optimal constant that minimizes the variance of <span class="math inline">\(\hat{\theta_c}=c\hat{\theta_2}+(1-c)\hat{\theta_2}\)</span>. Derive <span class="math inline">\(c^{\star}\)</span> for the general case. That is, if <span class="math inline">\(\hat{\theta_1}\)</span> and <span class="math inline">\(\hat{\theta_2}\)</span> are any two unbiased estimators of <span class="math inline">\(\theta\)</span>, find the value <span class="math inline">\(c^\star\)</span> that minimizes the variance of the estimator <span class="math inline">\(\hat{\theta_c}=c\hat{\theta_1}+(1-c)\hat{\theta_2}\)</span> in equation <span class="math display">\[\operatorname{Var}\left(\hat{\theta}_{2}\right)+c^{2} \operatorname{Var}\left(\hat{\theta}_{1}-\hat{\theta}_{2}\right)+2 c \operatorname{Cov}\left(\hat{\theta}_{2}, \hat{\theta}_{1}-\hat{\theta}_{2}\right)\]</span>.</p>
<div id="solution-2" class="section level3">
<h3>Solution</h3>
<p><span class="math display">\[\begin{align}
f(c)&amp;=\operatorname{Var}\left(\hat{\theta}_{2}\right)+c^{2} \operatorname{Var}\left(\hat{\theta}_{1}-\hat{\theta}_{2}\right)+2 c \operatorname{Cov}\left(\hat{\theta}_{2}, \hat{\theta}_{1}-\hat{\theta}_{2}\right)\\
&amp;=\operatorname{Var}\left(\hat{\theta}_{1}-\hat{\theta}_{2}\right)(c+\frac{\operatorname{Cov}\left(\hat{\theta}_{2}, \hat{\theta}_{1}-\hat{\theta}_{2}\right)}{\operatorname{Var}\left(\hat{\theta}_{1}-\hat{\theta}_{2}\right)})^2+\operatorname{Var}\left(\hat{\theta}_{2}\right)-\frac{\operatorname{Cov}^2\left(\hat{\theta}_{2}, \hat{\theta}_{1}-\hat{\theta}_{2}\right)}{\operatorname{Var}\left(\hat{\theta}_{1}-\hat{\theta}_{2}\right)}
\end{align}.\]</span> So when <span class="math display">\[c^{\star}=-\frac{\operatorname{Cov}\left(\hat{\theta}_{2}, \hat{\theta}_{1}-\hat{\theta}_{2}\right)}{\operatorname{Var}\left(\hat{\theta}_{1}-\hat{\theta}_{2}\right)}=\frac{\operatorname{Var}(\hat{\theta}_2)-\operatorname{Cov}(\hat{\theta}_{1},\hat{\theta}_{2})}{\operatorname{Var}(\hat{\theta}_1)+\operatorname{Var}(\hat{\theta}_2)-2\operatorname{Cov}(\hat{\theta}_{1},\hat{\theta}_{2})},\]</span> we have <span class="math display">\[\begin{align}f_{min}(c)=f(c^{\star})&amp;=\operatorname{Var}\left(\hat{\theta}_{2}\right)-\frac{\operatorname{Cov}^2\left(\hat{\theta}_{2}, \hat{\theta}_{1}-\hat{\theta}_{2}\right)}{\operatorname{Var}\left(\hat{\theta}_{1}-\hat{\theta}_{2}\right)}\\&amp;=\operatorname{Var}(\hat{\theta}_2)(1-\operatorname{Cor}^2(\hat{\theta}_2,\hat{\theta}_1-\hat{\theta}_2))
\end{align}\]</span><br />
# HOMEWORK 3<br />
## 5.13<br />
Find two importance functions <span class="math inline">\(f_1\)</span> and <span class="math inline">\(f_2\)</span> that are supported on <span class="math inline">\((1,\infty)\)</span> and are “close” to <span class="math display">\[g(x)=\frac{x^2}{\sqrt{2\pi}}e^{-x^2/2}, x&gt;1\]</span> Which of your two importance functions should produce the smaller variance in estimating <span class="math display">\[\int_1^{\infty}\frac{x^2}{\sqrt{2\pi}}e^{-x^2/2}dx\]</span>by importance sampling? Explain.</p>
</div>
<div id="solution-3" class="section level3">
<h3>Solution</h3>
<p>Here <span class="math inline">\(\int_1^{\infty}\frac{x^2}{\sqrt{2\pi}}e^{-x^2/2}dx=\int_1^{\infty}\frac{\sqrt{x}}{2\sqrt{2\pi}}e^{-\frac{x}{2}}dx\)</span>. We choose <span class="math inline">\(f_1=e^{-\frac{x}{2}}\)</span> and <span class="math inline">\(f_2=\frac{1}{x^2}\)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>n=<span class="dv">3000</span><span class="co">#numbers of variables</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>g=<span class="cf">function</span>(x){</span>
<span id="cb11-3"><a href="#cb11-3"></a>  x<span class="op">^</span><span class="fl">0.5</span><span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span>x<span class="op">/</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">2</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>pi)<span class="op">^</span><span class="fl">0.5</span><span class="op">*</span>(x<span class="op">&gt;</span><span class="dv">1</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>}</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#f1=e^(-x/2)</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">##cdf F1=1-e^(-(x-1)/2)</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>u=<span class="kw">runif</span>(n)</span>
<span id="cb11-8"><a href="#cb11-8"></a>x=<span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="kw">log</span>(<span class="dv">1</span><span class="op">-</span>u)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>fg=<span class="kw">g</span>(x)<span class="op">/</span><span class="kw">exp</span>(<span class="op">-</span>x<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a>E1=<span class="kw">mean</span>(fg)</span>
<span id="cb11-11"><a href="#cb11-11"></a>SD1=<span class="kw">sd</span>(fg)</span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#f2=1/x^2</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">##cdf F2=1-1/x</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>u=<span class="kw">runif</span>(n)</span>
<span id="cb11-15"><a href="#cb11-15"></a>x=<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>u)</span>
<span id="cb11-16"><a href="#cb11-16"></a>fg=<span class="kw">g</span>(x)<span class="op">*</span>x<span class="op">^</span><span class="dv">2</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>E2=<span class="kw">mean</span>(fg)</span>
<span id="cb11-18"><a href="#cb11-18"></a>SD2=<span class="kw">sd</span>(fg)</span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">#results</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="kw">cbind</span>(<span class="st">&quot;E&quot;</span>=<span class="kw">c</span>(E1,E2),<span class="st">&quot;SD&quot;</span>=<span class="kw">c</span>(SD1,SD2))</span></code></pre></div>
<pre><code>##              E        SD
## [1,] 0.3315404 0.1018910
## [2,] 0.4044214 0.2693487</code></pre>
<p>The first function <span class="math inline">\(f_1=e^{-\frac{x}{2}}\)</span> produces smaller variance. We can find the reason from the following picture. <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAaVBMVEUAAAAAADoAAGYAAP8AOjoAOpAAZrY6AAA6ADo6AGY6Ojo6kNtmAABmADpmAGZmOpBmZmZmtttmtv+QOgCQOmaQZgCQ2/+2ZgC2/7a2///bkDrb2//b/9vb////tmb/25D//7b//9v///+gQL8ZAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAHaklEQVR4nO2da3fcJhRFFU9tp/WkaTytp1EbzeP//8hKQmNP3IED4l64ks/+0NVYCNBecCUexs2ZBGlqV8A6FASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIICyoWQy1BMlmpwcFASgIUFhQeteuDVsQgIIAFASgIAAFASgIQEEACgJ8QEFpA9IPJChgI3QpOvukyuyb5uG064t8Fskum8jBzQ1NOoLa+x+9o4fz+bh9Esgui/SR3093qAg67Xot3aeXs1OVm10G80fFlztVBB23fc/q7r6fL//Ny24uInMG621BQjMqyjFoVJWdXTpyE07rfIsJ5r6+7yDh6crVCZLOWFtQW/YtJj/Xva5Je4VcV9TFdKyvRpDWQpKSoPEV3+OJQApL/bL5XeUsnnCgbabvw64p8qGo+FWlN9RwlBhqqC7T6g1WHQUGq0Y+ys22IO1RnXjCgfYyBtOPQdrTAkpvsePWvcU87UfuudSnTZb9HVRgF82SBRXZZDRDUDeNpnxTPbLlqmYhWcqUsA8uD+7/+o9l73eyYLmKOcgW4xIef7928vO/dMpVy0C6HGMxqNi6Wrqg0z9Fy719d8F1x+SEx60LQqc/50egTEEl161nvcWGFa82J0TnPWPRdf05MchN9njGENLl3rjVvKDRUNZXUI6g0vtCZiTcN823nX+YFcwle9K+sJ9ZQXrsXV2dGFTazxxBX13TqfEWq/ArHov6UCyvZ1lDjRp+ljRYrfMrVMuZ7qiiZ0ExqJKfxQiq9iuKCxFUS4+yoMOjN06lZVfPT/Jrfvs2WPC/wyJSJT1y+f61GXBlx94yJTztYt7t03qhUAsqqmfz5iat8EvC0+4hIvVxO4xlZQSV8bPZvFeTWPprwi7uA2j/6UVGkLqf22KSi0+uZ9s8SQjS8+NrMzPLT6/o4fGXfEEqfmLEJFfg8hZ7Pn55ibylH63lCpL2k6ImsQYXQU/xgvLLlfMT1Z2yqjAlbGO+g67I2kgu8v0z18ylDskJs1pQ0px0rp5MNYmVKD8WyyhRRE1iLa4n7S9kzAjhcmf1r9mhxl+N9ITdtKrx7P2NXYmN5Ol6hM2k1uNt88I01mjvf/i2sApsJE/xI99s5lTkqou5ntXdffdtghbYBhxbLz0ziRW5bkHu6YcW5BGUv5EcV0u12STV5H8JX2OQd2Cf24JQfC5iZmLOa358j/UtY+8NwXkbyUPXyjSbK5S+g3I2kvsuFXczYvBD8dalKm5G7Al6f6VOw3nFnKDrC5XdjFgT9PpzA25GjAlyP7YiZ8CWoMaWnAFTghpjcgbsCNpsGnN2zlYEDf3K6BHTBgS5fmVTT3VB6XsESlNY0LtJ+83bz0WyV8BAF5PPXBITggz7MSHIbv86mxBkWY8FQbb91Bdk3E9tQabDz0hdQeb11Ba0AJQElT7kTQ8dQaUPeVNERVDhQ95UURFU9pA3XdiCAFoxqNghb9oYXJu3Bb+DABQE0BZU+ERyeerOSS8AdjEABQE4WAVwsAqoNtRYDBqCIgarcZmC63mXc2/PSB7RguIyXaugiMFqXKarFYQHq3GZrleQUKYUlHedgigo7zoFfXhBa4KCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBNAQdfg0seYxrj4EZ7bYZ/8ZQgH1gwtfNCfuPpT08hq7eQkHQcRtYEzrt+sdv/ZUcto10QUNdaEb88Dkot+tvvfwZrEjkBXXBoxjdObC+3TPn8fy04MnEfRsJCAqv17l1K2/hNxEX1DVP4VqOiYJtJCiovf8rIKgNtg7Qvm6iEYOwIP8ZTgNtQF//jKEYtP8tFOG6u7+3qX8grIqg4LpjF3qEoZMEBLkDwfe++8e/Lhd3tPgrNQR14EVy2nkVDEveoRYULt81TdzAr6kgCKxbnwMhagwiUJD3QHAXngPnhd+gvKAWBwH/E057V8JP6I3FrmJpobq4oDb4dE5N2HCgBYHb3f4d213s8BhuP8PTX22z8SXxXhuimzdIjyEM5P6e0oKmTuJ/ke9hDwrGIHB7Fx7n3ICDVQAFASgIQEEACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFASgIQEEACgJQEMC6oGHXXOCPT+tjXdCw3Sl8WJEy1gUNe5u/pG//lsO8oPM+8bdPhLEvqAM78pQxL+i0+yNpV6o05gW19/+mbUsVxrqgYWtz2sZmYawLcvumK4Zp64KqQ0EACgJQEICCABQEoCAABQEoCEBBAAoCUBCAggAUBKAgAAUBKAhAQQAKAlAQgIIAFASgIAAFAf4D9ntEG8zSCJMAAAAASUVORK5CYII=" /><!-- --></p>
<p>The blue line represents <span class="math inline">\(g(x)/f_1(x)\)</span>, and the black line represents <span class="math inline">\(g(x)/f_2(x)\)</span>. It’s clear that the blue line is mach smaller than the black line in most of the part. So <span class="math inline">\(Var(g(x)/f_1(x))&lt;Var(g(x)/f_2(x))\)</span>.</p>
</div>
</div>
<div id="section-3" class="section level2">
<h2>5.15</h2>
<p>Obtain the stratified importance sampling estimate in Example 5.13 and compare it with the result of Example 5.10.</p>
<div id="sulution" class="section level3">
<h3>Sulution</h3>
<p>Our goal is to estimate <span class="math inline">\(\int_0^1\frac{e^{-x}}{1+x^2}dx\)</span>.<br />
In Example 5.10, the best result was obtained with importance function <span class="math inline">\(f_3=e^{-x}/(1-e^{-1})\)</span>.<br />
In Example 5.13, we divide the interval(0,1) into five subintervals. Here is how it goes.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>n=<span class="dv">3000</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>k=<span class="dv">5</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>m=n<span class="op">/</span>k<span class="co">#replicates per stratum</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>N=<span class="dv">100</span><span class="co">#number of times to repeat the estimation</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>g=<span class="cf">function</span>(x){</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="kw">exp</span>(<span class="op">-</span>x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>x<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>(x<span class="op">&gt;</span><span class="dv">0</span>)<span class="op">*</span>(x<span class="op">&lt;</span><span class="dv">1</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a>}</span>
<span id="cb13-8"><a href="#cb13-8"></a>E1=<span class="ot">NULL</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>E2=<span class="ot">NULL</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N){</span>
<span id="cb13-11"><a href="#cb13-11"></a>  U=<span class="kw">runif</span>(n)</span>
<span id="cb13-12"><a href="#cb13-12"></a>  x=<span class="kw">g</span>(U)</span>
<span id="cb13-13"><a href="#cb13-13"></a>  E1[i]=<span class="kw">mean</span>(x)</span>
<span id="cb13-14"><a href="#cb13-14"></a>  E=<span class="ot">NULL</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k){</span>
<span id="cb13-16"><a href="#cb13-16"></a>    u=<span class="kw">runif</span>(m,(j<span class="dv">-1</span>)<span class="op">/</span>k,j<span class="op">/</span>k)</span>
<span id="cb13-17"><a href="#cb13-17"></a>    x=<span class="kw">g</span>(u)</span>
<span id="cb13-18"><a href="#cb13-18"></a>    E[j]=<span class="kw">mean</span>(x)</span>
<span id="cb13-19"><a href="#cb13-19"></a>  }</span>
<span id="cb13-20"><a href="#cb13-20"></a>  E2[i]=<span class="kw">mean</span>(E)</span>
<span id="cb13-21"><a href="#cb13-21"></a>}</span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="kw">cbind</span>(<span class="st">&quot;mean&quot;</span>=<span class="kw">c</span>(<span class="kw">mean</span>(E1),<span class="kw">mean</span>(E2)),<span class="st">&quot;sd&quot;</span>=<span class="kw">c</span>(<span class="kw">sd</span>(E1),<span class="kw">sd</span>(E2)))</span></code></pre></div>
<pre><code>##           mean           sd
## [1,] 0.5246601 0.0045523655
## [2,] 0.5247083 0.0009588614</code></pre>
<p>So the sd is much smaller than we get in Example 5.10.</p>
</div>
</div>
<div id="section-4" class="section level2">
<h2>6.4</h2>
<p>Suppose that <span class="math inline">\(X_1,\dots,X_n\)</span> are a random sample from a lognormal distribution with unknown parameters. Construct a 95% confidence interval for the parameter <span class="math inline">\(\mu\)</span>. Use a Monte Carlo method to obtain an empirical estimate of the confidence level.</p>
<div id="solution-4" class="section level3">
<h3>Solution</h3>
<p>We know that if X has the distribution of lognormal, then Y=ln(X) has normal distribution.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>miu=<span class="dv">2</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>s=<span class="dv">1</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>n=<span class="dv">10</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>alpha=<span class="fl">0.05</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>X=<span class="kw">exp</span>(<span class="kw">rnorm</span>(n,miu,s))</span>
<span id="cb15-6"><a href="#cb15-6"></a>miu_hat=<span class="kw">mean</span>(<span class="kw">log</span>(X))</span>
<span id="cb15-7"><a href="#cb15-7"></a>S_hat=<span class="kw">sum</span>((<span class="kw">log</span>(X)<span class="op">-</span>miu_hat)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(n<span class="dv">-1</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a>CI=<span class="kw">c</span>(miu_hat<span class="op">-</span>S_hat<span class="op">*</span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,n<span class="dv">-1</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>,miu_hat<span class="op">+</span>S_hat<span class="op">*</span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,n<span class="dv">-1</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>)</span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="kw">c</span>((CI[<span class="dv">1</span>]),(CI[<span class="dv">2</span>]))<span class="co">#95%CI</span></span></code></pre></div>
<pre><code>## [1] 1.973273 2.925902</code></pre>
<p>Next we repeat the process to see its real confidence level.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>m=<span class="dv">3000</span><span class="co">#repeat times</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>CI=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span>m,<span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>q=<span class="dv">0</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb17-5"><a href="#cb17-5"></a>  X=<span class="kw">exp</span>(<span class="kw">rnorm</span>(n,miu,s))</span>
<span id="cb17-6"><a href="#cb17-6"></a>  miu_hat=<span class="kw">mean</span>(<span class="kw">log</span>(X))</span>
<span id="cb17-7"><a href="#cb17-7"></a>  S_hat=(<span class="kw">sum</span>((<span class="kw">log</span>(X)<span class="op">-</span>miu_hat)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(n<span class="dv">-1</span>))<span class="op">^</span><span class="fl">0.5</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  CI[i,]=<span class="kw">c</span>(miu_hat<span class="op">-</span>S_hat<span class="op">*</span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,n<span class="dv">-1</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>,miu_hat<span class="op">+</span>S_hat<span class="op">*</span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,n<span class="dv">-1</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>)</span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="cf">if</span>(CI[i,<span class="dv">1</span>]<span class="op">&lt;=</span>miu<span class="op">&amp;&amp;</span>CI[i,<span class="dv">2</span>]<span class="op">&gt;=</span>miu)q=q<span class="op">+</span><span class="dv">1</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>}</span>
<span id="cb17-11"><a href="#cb17-11"></a>q<span class="op">/</span>m</span></code></pre></div>
<pre><code>## [1] 0.9516667</code></pre>
</div>
</div>
<div id="section-5" class="section level2">
<h2>6.5</h2>
<p>Suppose a 95% symmetric t-interval is applied to estimate a mean, but the sample data are non-normal. Then the probability that the confidence interval covers the mean is not necessarily equal to 0.95. Use a Monte Carlo experiment to estimate the coverage probability of the t-interval for random samples of <span class="math inline">\(\mathcal{X}^2(2)\)</span> data with sample size <span class="math inline">\(n=20\)</span>. Compare your t-interval results with the simulation results in Example 6.4.(The t-interval should be more robust to departures from normality than the interval for variance.)</p>
<div id="solution-5" class="section level3">
<h3>Solution</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>n=<span class="dv">20</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>alpha=<span class="fl">0.05</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>m=<span class="dv">1000</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>q=p=<span class="dv">0</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>U1=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span>m,<span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb19-6"><a href="#cb19-6"></a>U2=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span>m,<span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb19-8"><a href="#cb19-8"></a>  X1=<span class="kw">rchisq</span>(n,<span class="dt">df=</span><span class="dv">2</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a>  S=(<span class="kw">sum</span>((X1<span class="op">-</span><span class="kw">mean</span>(X1))<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(n<span class="dv">-1</span>))<span class="op">^</span><span class="fl">0.5</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>  U1[i,]=<span class="kw">c</span>(<span class="kw">mean</span>(X1)<span class="op">-</span>S<span class="op">*</span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,n<span class="dv">-1</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>,<span class="kw">mean</span>(X1)<span class="op">+</span>S<span class="op">*</span><span class="kw">qt</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>,n<span class="dv">-1</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>)</span>
<span id="cb19-11"><a href="#cb19-11"></a>  U2[i,]=<span class="kw">c</span>(<span class="kw">mean</span>(X1)<span class="op">-</span>S<span class="op">*</span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>,<span class="kw">mean</span>(X1)<span class="op">+</span>S<span class="op">*</span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>)<span class="op">/</span>n<span class="op">^</span><span class="fl">0.5</span>)</span>
<span id="cb19-12"><a href="#cb19-12"></a>  <span class="cf">if</span>(U1[i,<span class="dv">1</span>]<span class="op">&lt;=</span><span class="dv">2</span><span class="op">&amp;&amp;</span>U1[i,<span class="dv">2</span>]<span class="op">&gt;=</span><span class="dv">2</span>)q=q<span class="op">+</span><span class="dv">1</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>  <span class="cf">if</span>(U2[i,<span class="dv">1</span>]<span class="op">&lt;=</span><span class="dv">2</span><span class="op">&amp;&amp;</span>U2[i,<span class="dv">2</span>]<span class="op">&gt;=</span><span class="dv">2</span>)p=p<span class="op">+</span><span class="dv">1</span></span>
<span id="cb19-14"><a href="#cb19-14"></a>}</span>
<span id="cb19-15"><a href="#cb19-15"></a>q<span class="op">/</span>m<span class="co">#t-interval</span></span></code></pre></div>
<pre><code>## [1] 0.927</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>p<span class="op">/</span>m<span class="co">#interval for variance</span></span></code></pre></div>
<pre><code>## [1] 0.911</code></pre>
</div>
</div>
</div>
<div id="homework-4" class="section level1">
<h1>HOMEWORK 4</h1>
<div id="section-6" class="section level2">
<h2>6.7</h2>
<p>Estimate the power of the skewness test of normality against symmetric <span class="math inline">\(Beta(\alpha,\alpha)\)</span> distributions and comment on the results. Are the results different for heavy-tailed symmetric alternatives such as <span class="math inline">\(t(v)\)</span>?</p>
<div id="solution-6" class="section level3">
<h3>Solution</h3>
<p>First, the skewness <span class="math inline">\(\sqrt{\beta_1}\)</span> of a random variable X is defined by <span class="math display">\[\sqrt{\beta_{1}}=\frac{E\left[\left(X-\mu_{X}\right)\right]^{3}}{\sigma_{X}^{3}}\]</span> where <span class="math inline">\(\mu_{X}=E[X]\)</span> and <span class="math inline">\(\sigma_{X}^{2}=\operatorname{Var}(X)\)</span>. And the sample coefficient of skewness is denoted by <span class="math inline">\(\sqrt{b_1}\)</span>, defined as <span class="math display">\[\sqrt{b_{1}}=\frac{\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\bar{X}\right)^{3}}{\left(\frac{1}{n} \sum_{i=1}^{n}\left(X_{i}-\bar{X}\right)^{2}\right)^{3 / 2}}.\]</span><br />
The hypotheses are <span class="math display">\[H_{0}: \sqrt{\beta_{1}}=0 ; \quad H_{1}: \sqrt{\beta_{1}} \neq 0,\]</span> where the sampling distribution of the skewness statistic is derived under the assumption of normality.<br />
Here we choose the sample sizes n=5,10,20,40,60,100,200, and 500, and <span class="math inline">\(\alpha\)</span> equal from 0.3 to 20 to estimate the power of the skewness test of normality against symmetric <span class="math inline">\(Beta(\alpha,\alpha)\)</span> distributions.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>sk &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co">#computes the sample skewness coeff.</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>xbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb23-4"><a href="#cb23-4"></a>m3 &lt;-<span class="st"> </span><span class="kw">mean</span>((x <span class="op">-</span><span class="st"> </span>xbar)<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a>m2 &lt;-<span class="st"> </span><span class="kw">mean</span>((x <span class="op">-</span><span class="st"> </span>xbar)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="kw">return</span>( m3 <span class="op">/</span><span class="st"> </span>m2<span class="op">^</span><span class="fl">1.5</span> )</span>
<span id="cb23-7"><a href="#cb23-7"></a>}</span>
<span id="cb23-8"><a href="#cb23-8"></a>alpha &lt;-<span class="st"> </span><span class="fl">.1</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>m &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>epsilon &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">.15</span>, <span class="fl">.01</span>), <span class="kw">seq</span>(.<span class="dv">15</span>, <span class="dv">1</span>, <span class="fl">.05</span>))</span>
<span id="cb23-12"><a href="#cb23-12"></a>N &lt;-<span class="st"> </span><span class="kw">length</span>(epsilon)</span>
<span id="cb23-13"><a href="#cb23-13"></a>pwr &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="co">#critical value for the skewness test</span></span>
<span id="cb23-15"><a href="#cb23-15"></a>cv &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="kw">sqrt</span>(<span class="dv">6</span><span class="op">*</span>(n<span class="dv">-2</span>) <span class="op">/</span><span class="st"> </span>((n<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(n<span class="op">+</span><span class="dv">3</span>))))</span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N) { <span class="co">#for each epsilon</span></span>
<span id="cb23-17"><a href="#cb23-17"></a>  e &lt;-<span class="st"> </span>epsilon[j]</span>
<span id="cb23-18"><a href="#cb23-18"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb23-19"><a href="#cb23-19"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) { <span class="co">#for each replicate</span></span>
<span id="cb23-20"><a href="#cb23-20"></a>    a &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">replace =</span> <span class="ot">TRUE</span>,</span>
<span id="cb23-21"><a href="#cb23-21"></a>                    <span class="dt">size =</span> n, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>e, e))</span>
<span id="cb23-22"><a href="#cb23-22"></a>    x &lt;-<span class="st"> </span><span class="kw">rbeta</span>(n, a, a)</span>
<span id="cb23-23"><a href="#cb23-23"></a>    sktests[i] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(<span class="kw">sk</span>(x)) <span class="op">&gt;=</span><span class="st"> </span>cv)</span>
<span id="cb23-24"><a href="#cb23-24"></a>  }</span>
<span id="cb23-25"><a href="#cb23-25"></a>  pwr[j] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests)</span>
<span id="cb23-26"><a href="#cb23-26"></a>}</span>
<span id="cb23-27"><a href="#cb23-27"></a><span class="co">#plot power vs epsilon</span></span>
<span id="cb23-28"><a href="#cb23-28"></a><span class="kw">plot</span>(epsilon, pwr, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb23-29"><a href="#cb23-29"></a>     <span class="dt">xlab =</span> <span class="kw">bquote</span>(epsilon), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb23-30"><a href="#cb23-30"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.1</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb23-31"><a href="#cb23-31"></a>se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(pwr <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pwr) <span class="op">/</span><span class="st"> </span>m) <span class="co">#add standard errors</span></span>
<span id="cb23-32"><a href="#cb23-32"></a><span class="kw">lines</span>(epsilon, pwr<span class="op">+</span>se, <span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb23-33"><a href="#cb23-33"></a><span class="kw">lines</span>(epsilon, pwr<span class="op">-</span>se, <span class="dt">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The result shows that when <span class="math inline">\(\alpha\)</span> is small, about less than 1, the estimates of Type I error rate is less than what we set.<br />
If we consider heavy-tailed symmetric alternatives such as t(v):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>alpha &lt;-<span class="st"> </span><span class="fl">.1</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>m &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>epsilon &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">.15</span>, <span class="fl">.01</span>), <span class="kw">seq</span>(.<span class="dv">15</span>, <span class="dv">1</span>, <span class="fl">.05</span>))</span>
<span id="cb24-5"><a href="#cb24-5"></a>N &lt;-<span class="st"> </span><span class="kw">length</span>(epsilon)</span>
<span id="cb24-6"><a href="#cb24-6"></a>pwr &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co">#critical value for the skewness test</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>cv &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="kw">sqrt</span>(<span class="dv">6</span><span class="op">*</span>(n<span class="dv">-2</span>) <span class="op">/</span><span class="st"> </span>((n<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(n<span class="op">+</span><span class="dv">3</span>))))</span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N) { <span class="co">#for each epsilon</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>  e &lt;-<span class="st"> </span>epsilon[j]</span>
<span id="cb24-11"><a href="#cb24-11"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) { <span class="co">#for each replicate</span></span>
<span id="cb24-13"><a href="#cb24-13"></a>    v &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>), <span class="dt">replace =</span> <span class="ot">TRUE</span>,</span>
<span id="cb24-14"><a href="#cb24-14"></a>                    <span class="dt">size =</span> n, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>e, e))</span>
<span id="cb24-15"><a href="#cb24-15"></a>    x &lt;-<span class="st"> </span><span class="kw">rt</span>(n, v)</span>
<span id="cb24-16"><a href="#cb24-16"></a>    sktests[i] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(<span class="kw">sk</span>(x)) <span class="op">&gt;=</span><span class="st"> </span>cv)</span>
<span id="cb24-17"><a href="#cb24-17"></a>  }</span>
<span id="cb24-18"><a href="#cb24-18"></a>  pwr[j] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests)</span>
<span id="cb24-19"><a href="#cb24-19"></a>}</span>
<span id="cb24-20"><a href="#cb24-20"></a><span class="co">#plot power vs epsilon</span></span>
<span id="cb24-21"><a href="#cb24-21"></a><span class="kw">plot</span>(epsilon, pwr, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb24-22"><a href="#cb24-22"></a>     <span class="dt">xlab =</span> <span class="kw">bquote</span>(epsilon), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb24-23"><a href="#cb24-23"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.1</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb24-24"><a href="#cb24-24"></a>se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(pwr <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pwr) <span class="op">/</span><span class="st"> </span>m) <span class="co">#add standard errors</span></span>
<span id="cb24-25"><a href="#cb24-25"></a><span class="kw">lines</span>(epsilon, pwr<span class="op">+</span>se, <span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb24-26"><a href="#cb24-26"></a><span class="kw">lines</span>(epsilon, pwr<span class="op">-</span>se, <span class="dt">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The result is very different from what we get in Beta distribution.</p>
</div>
</div>
<div id="section-7" class="section level2">
<h2>6.8</h2>
<p>Refer to Example 6.16. Repeat the simulation, but also compute the F test of equal variance, at significance level <span class="math inline">\(\hat{\alpha}=0.055\)</span>. Compare the power of the Count Five test and F test for small, medium, and large sample sizes.(Recall that the F test is not applicable for non-normal distributions.)<br />
### Solution</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>count5test &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb25-2"><a href="#cb25-2"></a>  X &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb25-3"><a href="#cb25-3"></a>  Y &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb25-4"><a href="#cb25-4"></a>  outx &lt;-<span class="st"> </span><span class="kw">sum</span>(X <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(Y)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(X <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(Y))</span>
<span id="cb25-5"><a href="#cb25-5"></a>  outy &lt;-<span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(X)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(Y <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(X))</span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="co"># return 1 (reject) or 0 (do not reject H0)</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="kw">return</span>(<span class="kw">as.integer</span>(<span class="kw">max</span>(<span class="kw">c</span>(outx, outy)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>))</span>
<span id="cb25-8"><a href="#cb25-8"></a>}</span>
<span id="cb25-9"><a href="#cb25-9"></a>Ftest=<span class="cf">function</span>(x,y,n){</span>
<span id="cb25-10"><a href="#cb25-10"></a>  X &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb25-11"><a href="#cb25-11"></a>  Y &lt;-<span class="st"> </span>y <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y)</span>
<span id="cb25-12"><a href="#cb25-12"></a>  S1=<span class="kw">sum</span>(X<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(<span class="kw">length</span>(x)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb25-13"><a href="#cb25-13"></a>  S2=<span class="kw">sum</span>(Y<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span>(<span class="kw">length</span>(y)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb25-14"><a href="#cb25-14"></a>  <span class="kw">return</span>(<span class="kw">as.integer</span>(S1<span class="op">/</span>S2<span class="op">&gt;=</span><span class="kw">qf</span>(<span class="dv">1</span><span class="fl">-0.055</span>,n<span class="dv">-1</span>,n<span class="dv">-1</span>)))</span>
<span id="cb25-15"><a href="#cb25-15"></a>}</span>
<span id="cb25-16"><a href="#cb25-16"></a>sigma1 &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>sigma2 &lt;-<span class="st"> </span><span class="fl">1.5</span></span>
<span id="cb25-18"><a href="#cb25-18"></a>m=<span class="dv">10000</span></span>
<span id="cb25-19"><a href="#cb25-19"></a>n=<span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">50</span>,<span class="dv">200</span>)</span>
<span id="cb25-20"><a href="#cb25-20"></a>power=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span><span class="dv">3</span>,<span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>){</span>
<span id="cb25-22"><a href="#cb25-22"></a>  power[i,] &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(<span class="kw">replicate</span>(m, <span class="dt">expr=</span>{</span>
<span id="cb25-23"><a href="#cb25-23"></a>    x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n[i], <span class="dv">0</span>, sigma1)</span>
<span id="cb25-24"><a href="#cb25-24"></a>    y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n[i], <span class="dv">0</span>, sigma2)</span>
<span id="cb25-25"><a href="#cb25-25"></a>    <span class="kw">c</span>(<span class="kw">count5test</span>(x, y),<span class="kw">Ftest</span>(x,y,n[i]))</span>
<span id="cb25-26"><a href="#cb25-26"></a>  }))</span>
<span id="cb25-27"><a href="#cb25-27"></a>}</span>
<span id="cb25-28"><a href="#cb25-28"></a>power</span></code></pre></div>
<pre><code>##        [,1]  [,2]
## [1,] 0.3092 8e-04
## [2,] 0.6608 0e+00
## [3,] 0.9505 0e+00</code></pre>
</div>
<div id="c" class="section level2">
<h2>6.C</h2>
<p>Repeat Examples 6.8 and 6.10 for Mardia’s multivariate skewness test. Mardia proposed tests of multivariate normality based on multivariate generalizations of skewness and kurtosis. If X and Y are iid, the multivariate population skewness <span class="math inline">\(\beta_{1,d}\)</span> is defined by Mardia as <span class="math display">\[\beta_{1, d}=E\left[(X-\mu)^{T} \Sigma^{-1}(Y-\mu)\right]^{3}.\]</span> Under normality, <span class="math inline">\(\beta_{1,d}=0\)</span>. The multivariate skeweness statistic is <span class="math display">\[b_{1, d}=\frac{1}{n^{2}} \sum_{i, j=1}^{n}\left(\left(X_{i}-\bar{X}\right)^{T} \widehat{\Sigma}^{-1}\left(X_{j}-\bar{X}\right)\right)^{3}\]</span> Where <span class="math inline">\(\widehat{\Sigma}\)</span> is the maximum likelihood estimator of covariance. Large values of <span class="math inline">\(b_{1,d}\)</span> are significant. The asymptotic distribution of <span class="math inline">\(nb_{1,d}/6\)</span> is chisquared with d(d + 1)(d + 2)/6 degrees of freedom.</p>
<div id="solution-7" class="section level3">
<h3>Solution</h3>
<div id="example-6.8" class="section level4">
<h4>Example 6.8</h4>
<p>Here I set d=3.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>n=<span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">50</span>)</span>
<span id="cb27-2"><a href="#cb27-2"></a>cv=<span class="kw">qchisq</span>(<span class="fl">0.975</span>,<span class="dv">3</span><span class="op">*</span><span class="dv">4</span><span class="op">*</span><span class="dv">5</span><span class="op">/</span><span class="dv">6</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a>sk &lt;-<span class="st"> </span><span class="cf">function</span>(x,n) {</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="co">#computes the sample skewness coeff.</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  xbar=<span class="kw">c</span>(<span class="kw">mean</span>(x[,<span class="dv">1</span>]),<span class="kw">mean</span>(x[,<span class="dv">2</span>]),<span class="kw">mean</span>(x[,<span class="dv">3</span>]))</span>
<span id="cb27-6"><a href="#cb27-6"></a>  E=<span class="kw">solve</span>(<span class="kw">cov</span>(x,x))</span>
<span id="cb27-7"><a href="#cb27-7"></a>  m=<span class="dv">0</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  y=x<span class="op">-</span>xbar</span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="cf">for</span>(l1 <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(n<span class="dv">-1</span>)){</span>
<span id="cb27-10"><a href="#cb27-10"></a>    <span class="cf">for</span>(l2 <span class="cf">in</span> (l1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n){</span>
<span id="cb27-11"><a href="#cb27-11"></a>      m=m<span class="op">+</span><span class="dv">2</span><span class="op">*</span>(<span class="kw">t</span>(y[l1,])<span class="op">%*%</span>E<span class="op">%*%</span>y[l2,])<span class="op">^</span><span class="dv">3</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>    }</span>
<span id="cb27-13"><a href="#cb27-13"></a>    m=m<span class="op">+</span>(<span class="kw">t</span>(y[l1,])<span class="op">%*%</span>E<span class="op">%*%</span>y[l1,])<span class="op">^</span><span class="dv">3</span></span>
<span id="cb27-14"><a href="#cb27-14"></a>  }</span>
<span id="cb27-15"><a href="#cb27-15"></a>  m=m<span class="op">+</span>(<span class="kw">t</span>(y[n,])<span class="op">%*%</span>E<span class="op">%*%</span>y[n,])<span class="op">^</span><span class="dv">3</span></span>
<span id="cb27-16"><a href="#cb27-16"></a>  <span class="kw">return</span>(m<span class="op">/</span>n<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb27-17"><a href="#cb27-17"></a>}</span>
<span id="cb27-18"><a href="#cb27-18"></a>p.reject &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(n))<span class="co">#to store sim. results</span></span>
<span id="cb27-19"><a href="#cb27-19"></a>m &lt;-<span class="st"> </span><span class="dv">10000</span> <span class="co">#num. repl. each sim.</span></span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(n)) {</span>
<span id="cb27-21"><a href="#cb27-21"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m) <span class="co">#test decisions</span></span>
<span id="cb27-22"><a href="#cb27-22"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) {</span>
<span id="cb27-23"><a href="#cb27-23"></a>    x &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n[i]),<span class="kw">rnorm</span>(n[i]),<span class="kw">rnorm</span>(n[i]))</span>
<span id="cb27-24"><a href="#cb27-24"></a>    <span class="co">#test decision is 1 (reject) or 0</span></span>
<span id="cb27-25"><a href="#cb27-25"></a>    sktests[j] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(n[i]<span class="op">*</span><span class="kw">sk</span>(x,n[i])<span class="op">/</span><span class="dv">6</span>) <span class="op">&gt;=</span><span class="st"> </span>cv )</span>
<span id="cb27-26"><a href="#cb27-26"></a>  }</span>
<span id="cb27-27"><a href="#cb27-27"></a>  p.reject[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests) <span class="co">#proportion rejected  }</span></span>
<span id="cb27-28"><a href="#cb27-28"></a>}</span>
<span id="cb27-29"><a href="#cb27-29"></a>p.reject</span></code></pre></div>
<pre><code>## [1] 0.5688 0.2669 0.2010</code></pre>
<p>Compared with the result in Example 6.8, we can find that the probability of type I error is much bigger than before.</p>
</div>
<div id="example-6.10" class="section level4">
<h4>Example 6.10</h4>
<p>Here d=1.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>sk &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co">#computes the sample skewness coeff.</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>xbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb29-4"><a href="#cb29-4"></a>m3 &lt;-<span class="st"> </span><span class="kw">mean</span>((x <span class="op">-</span><span class="st"> </span>xbar)<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a>m2 &lt;-<span class="st"> </span><span class="kw">mean</span>((x <span class="op">-</span><span class="st"> </span>xbar)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="kw">return</span>( m3 <span class="op">/</span><span class="st"> </span>m2<span class="op">^</span><span class="fl">1.5</span> )</span>
<span id="cb29-7"><a href="#cb29-7"></a>}</span>
<span id="cb29-8"><a href="#cb29-8"></a>alpha &lt;-<span class="st"> </span><span class="fl">.1</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>n &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>m &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>epsilon &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">.15</span>, <span class="fl">.01</span>), <span class="kw">seq</span>(.<span class="dv">15</span>, <span class="dv">1</span>, <span class="fl">.05</span>))</span>
<span id="cb29-12"><a href="#cb29-12"></a>N &lt;-<span class="st"> </span><span class="kw">length</span>(epsilon)</span>
<span id="cb29-13"><a href="#cb29-13"></a>pwr &lt;-<span class="st"> </span><span class="kw">numeric</span>(N)</span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="co">#critical value for the skewness test</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>cv &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="kw">sqrt</span>(<span class="dv">6</span><span class="op">*</span>(n<span class="dv">-2</span>) <span class="op">/</span><span class="st"> </span>((n<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>(n<span class="op">+</span><span class="dv">3</span>))))</span>
<span id="cb29-16"><a href="#cb29-16"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N) { <span class="co">#for each epsilon</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>  e &lt;-<span class="st"> </span>epsilon[j]</span>
<span id="cb29-18"><a href="#cb29-18"></a>  sktests &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb29-19"><a href="#cb29-19"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m) { <span class="co">#for each replicate</span></span>
<span id="cb29-20"><a href="#cb29-20"></a>   sigma &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">replace =</span><span class="ot">TRUE</span>,<span class="dt">size =</span> n, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>e, e))</span>
<span id="cb29-21"><a href="#cb29-21"></a>   x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dv">0</span>, sigma)</span>
<span id="cb29-22"><a href="#cb29-22"></a>   sktests[i] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">abs</span>(<span class="kw">sk</span>(x)) <span class="op">&gt;=</span><span class="st"> </span>cv)</span>
<span id="cb29-23"><a href="#cb29-23"></a>  }</span>
<span id="cb29-24"><a href="#cb29-24"></a>  pwr[j] &lt;-<span class="st"> </span><span class="kw">mean</span>(sktests)</span>
<span id="cb29-25"><a href="#cb29-25"></a>}</span>
<span id="cb29-26"><a href="#cb29-26"></a><span class="co">#plot power vs epsilon</span></span>
<span id="cb29-27"><a href="#cb29-27"></a><span class="kw">plot</span>(epsilon, pwr, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb29-28"><a href="#cb29-28"></a>     <span class="dt">xlab =</span> <span class="kw">bquote</span>(epsilon), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb29-29"><a href="#cb29-29"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.1</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb29-30"><a href="#cb29-30"></a>se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(pwr <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pwr) <span class="op">/</span><span class="st"> </span>m) <span class="co">#add standard errors</span></span>
<span id="cb29-31"><a href="#cb29-31"></a><span class="kw">lines</span>(epsilon, pwr<span class="op">+</span>se, <span class="dt">lty =</span> <span class="dv">3</span>)</span>
<span id="cb29-32"><a href="#cb29-32"></a><span class="kw">lines</span>(epsilon, pwr<span class="op">-</span>se, <span class="dt">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
</div>
<div id="discussion" class="section level2">
<h2>Discussion</h2>
<p><span class="math display">\[H_0:p1=p2,  H_A:p1\ne p2\]</span><br />
We should use z-test.<br />
For methods 1, suppose the probability to reject the null hypothesis is <span class="math inline">\(p_1\)</span>, and for methods 2, suppose the probability to reject the null hypothesis is <span class="math inline">\(p_2\)</span>. If we repeat the experiments for many times, the results we get are actually obey binomial distribution.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>p1=<span class="fl">0.676</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>p2=<span class="fl">0.651</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>pc=(p1<span class="op">+</span>p2)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>n=<span class="dv">10000</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="dv">1</span><span class="op">-</span><span class="kw">pnorm</span>(p1<span class="op">-</span>p2,<span class="dv">0</span>,(pc<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>pc)<span class="op">*</span>(<span class="dv">2</span><span class="op">/</span>n))<span class="op">^</span><span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 9.156844e-05</code></pre>
<p>So we can say the powers are different at 0.05 level.</p>
</div>
</div>
<div id="homework-5" class="section level1">
<h1>HOMEWORK 5</h1>
<div id="section-8" class="section level2">
<h2>7.1</h2>
<p>Compute a jackknife estimate of the bias and the standard error of the correlation statistic in Example 7.2<br />
In example 7.2, the data used are from the bootstrap package, so I load bottstrap first.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">library</span>(bootstrap)</span></code></pre></div>
<pre><code>## Warning: package &#39;bootstrap&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>n=<span class="kw">length</span>(law[,<span class="dv">1</span>])<span class="co">#the length of data</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>theta.hat=<span class="kw">cor</span>(law<span class="op">$</span>LSAT,law<span class="op">$</span>GPA)<span class="co">#original data correlation</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>theta.jack=<span class="kw">numeric</span>(n)<span class="co">#set to store statistics from jackknife</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){</span>
<span id="cb34-5"><a href="#cb34-5"></a>  theta.jack[i] &lt;-<span class="st"> </span><span class="kw">cor</span>(law<span class="op">$</span>LSAT[<span class="op">-</span>i],law<span class="op">$</span>GPA[<span class="op">-</span>i])<span class="co">#leave the ith data out</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>}</span>
<span id="cb34-7"><a href="#cb34-7"></a>bias.jack &lt;-<span class="st"> </span>(n<span class="dv">-1</span>)<span class="op">*</span>(<span class="kw">mean</span>(theta.jack)<span class="op">-</span>theta.hat)<span class="co">#compute the bias</span></span>
<span id="cb34-8"><a href="#cb34-8"></a>se.jack &lt;-<span class="st"> </span><span class="kw">sqrt</span>((n<span class="dv">-1</span>)<span class="op">*</span><span class="kw">mean</span>((theta.jack<span class="op">-</span>theta.hat)<span class="op">^</span><span class="dv">2</span>))<span class="co">#compute the standard error</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="kw">round</span>(<span class="kw">c</span>(<span class="dt">original=</span>theta.hat,<span class="dt">bias.jack=</span>bias.jack,</span>
<span id="cb34-10"><a href="#cb34-10"></a>        <span class="dt">se.jack=</span>se.jack),<span class="dv">3</span>)<span class="co">#to show results</span></span></code></pre></div>
<pre><code>##  original bias.jack   se.jack 
##     0.776    -0.006     0.143</code></pre>
</div>
<div id="section-9" class="section level2">
<h2>7.5</h2>
<p>Refer to Excercise 7.4. Compute 95% bootstrap confidence intercals for the mean time between failures <span class="math inline">\(1/\lambda\)</span> by the standard normal, basic, percentile, and BCa methods. Compare the intervals and explain why they may differ.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">library</span>(boot)</span></code></pre></div>
<pre><code>## Warning: package &#39;boot&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>m=<span class="fl">1e3</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>ci.norm&lt;-ci.basic&lt;-ci.perc&lt;-ci.bca&lt;-<span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">2</span>)</span>
<span id="cb38-3"><a href="#cb38-3"></a>boot.mean &lt;-<span class="st"> </span><span class="cf">function</span>(x,i){</span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="kw">mean</span>(x[i])</span>
<span id="cb38-5"><a href="#cb38-5"></a>}</span>
<span id="cb38-6"><a href="#cb38-6"></a>dat=<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">18</span>,<span class="dv">43</span>,<span class="dv">85</span>,<span class="dv">91</span>,<span class="dv">98</span>,<span class="dv">100</span>,<span class="dv">130</span>,<span class="dv">230</span>,<span class="dv">487</span>)</span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb38-8"><a href="#cb38-8"></a>  de &lt;-<span class="st"> </span><span class="kw">boot</span>(dat,<span class="dt">statistic=</span>boot.mean, <span class="dt">R =</span> <span class="dv">1000</span>)</span>
<span id="cb38-9"><a href="#cb38-9"></a>  ci &lt;-<span class="st"> </span><span class="kw">boot.ci</span>(de,<span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;basic&quot;</span>,<span class="st">&quot;perc&quot;</span>,<span class="st">&quot;bca&quot;</span>))</span>
<span id="cb38-10"><a href="#cb38-10"></a>  ci.norm[i,]&lt;-ci<span class="op">$</span>norm[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]</span>
<span id="cb38-11"><a href="#cb38-11"></a>  ci.basic[i,]&lt;-ci<span class="op">$</span>basic[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb38-12"><a href="#cb38-12"></a>  ci.perc[i,]&lt;-ci<span class="op">$</span>percent[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb38-13"><a href="#cb38-13"></a>  ci.bca[i,]&lt;-ci<span class="op">$</span>bca[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb38-14"><a href="#cb38-14"></a>}</span>
<span id="cb38-15"><a href="#cb38-15"></a><span class="kw">cat</span>(<span class="st">&#39;norm =&#39;</span>,<span class="kw">c</span>(<span class="kw">mean</span>(ci.norm[,<span class="dv">1</span>]),<span class="kw">mean</span>(ci.norm[,<span class="dv">2</span>])),</span>
<span id="cb38-16"><a href="#cb38-16"></a>    <span class="st">&#39;basic =&#39;</span>,<span class="kw">c</span>(<span class="kw">mean</span>(ci.basic[,<span class="dv">1</span>]),<span class="kw">mean</span>(ci.basic[,<span class="dv">2</span>])),</span>
<span id="cb38-17"><a href="#cb38-17"></a>    <span class="st">&#39;perc =&#39;</span>,<span class="kw">c</span>(<span class="kw">mean</span>(ci.perc[,<span class="dv">1</span>]),<span class="kw">mean</span>(ci.perc[,<span class="dv">2</span>])),</span>
<span id="cb38-18"><a href="#cb38-18"></a>    <span class="st">&#39;BCa =&#39;</span>,<span class="kw">c</span>(<span class="kw">mean</span>(ci.bca[,<span class="dv">1</span>]),<span class="kw">mean</span>(ci.bca[,<span class="dv">2</span>]))</span>
<span id="cb38-19"><a href="#cb38-19"></a>)</span></code></pre></div>
<pre><code>## norm = 34.31574 181.7975 basic = 24.65124 169.4786 perc = 46.68811 191.5154 BCa = 56.8603 227.9891</code></pre>
</div>
<div id="section-10" class="section level2">
<h2>7.8</h2>
<p>Refer to Exercise 7.7, Obtain the jackknife estimate of bias and standard error of <span class="math inline">\(\hat{\theta}\)</span>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">library</span>(bootstrap)</span>
<span id="cb40-2"><a href="#cb40-2"></a>n=<span class="kw">length</span>(scor[,<span class="dv">1</span>])</span>
<span id="cb40-3"><a href="#cb40-3"></a>lambda_hat=<span class="kw">eigen</span>(<span class="kw">cov</span>(scor))<span class="op">$</span>values</span>
<span id="cb40-4"><a href="#cb40-4"></a>theta_hat=lambda_hat[<span class="dv">1</span>]<span class="op">/</span><span class="kw">sum</span>(lambda_hat)</span>
<span id="cb40-5"><a href="#cb40-5"></a>theta_jack=<span class="kw">rep</span>(<span class="dv">0</span>,n)</span>
<span id="cb40-6"><a href="#cb40-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</span>
<span id="cb40-7"><a href="#cb40-7"></a> lambda=<span class="kw">eigen</span>(<span class="kw">cov</span>(scor[<span class="op">-</span>i,]))<span class="op">$</span>values</span>
<span id="cb40-8"><a href="#cb40-8"></a> theta_jack[i]=lambda[<span class="dv">1</span>]<span class="op">/</span><span class="kw">sum</span>(lambda)</span>
<span id="cb40-9"><a href="#cb40-9"></a>}</span>
<span id="cb40-10"><a href="#cb40-10"></a>bias.jack &lt;-<span class="st"> </span>(n<span class="dv">-1</span>)<span class="op">*</span>(<span class="kw">mean</span>(theta.jack)<span class="op">-</span>theta.hat)<span class="co">#compute the bias</span></span>
<span id="cb40-11"><a href="#cb40-11"></a>se.jack &lt;-<span class="st"> </span><span class="kw">sqrt</span>((n<span class="dv">-1</span>)<span class="op">*</span><span class="kw">mean</span>((theta.jack<span class="op">-</span>theta.hat)<span class="op">^</span><span class="dv">2</span>))<span class="co">#compute the standard error</span></span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="kw">round</span>(<span class="kw">c</span>(<span class="dt">original=</span>theta.hat,<span class="dt">bias.jack=</span>bias.jack,</span>
<span id="cb40-13"><a href="#cb40-13"></a>        <span class="dt">se.jack=</span>se.jack),<span class="dv">3</span>)<span class="co">#to show results</span></span></code></pre></div>
<pre><code>##  original bias.jack   se.jack 
##     0.776    -0.040     0.355</code></pre>
</div>
<div id="section-11" class="section level2">
<h2>7.11</h2>
<p>In example 7.18, leave-one-out(n-fold) cross validation was used to select the best fitting model. Use leave-two-out cross validation to compare the models.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">library</span>(DAAG)</span></code></pre></div>
<pre><code>## Warning: package &#39;DAAG&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## 
## Attaching package: &#39;lattice&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:boot&#39;:
## 
##     melanoma</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw">attach</span>(ironslag)</span>
<span id="cb47-2"><a href="#cb47-2"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(magnetic) <span class="co">#in DAAG ironslag</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>e1 &lt;-<span class="st"> </span>e2 &lt;-<span class="st"> </span>e3 &lt;-<span class="st"> </span>e4 &lt;-<span class="st"> </span><span class="kw">numeric</span>(n<span class="op">*</span>(n<span class="dv">-1</span>)<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb47-4"><a href="#cb47-4"></a>p=<span class="dv">0</span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(n<span class="dv">-1</span>))</span>
<span id="cb47-6"><a href="#cb47-6"></a>  <span class="cf">for</span> (j <span class="cf">in</span> (i<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n) {</span>
<span id="cb47-7"><a href="#cb47-7"></a>    p=p<span class="op">+</span><span class="dv">1</span></span>
<span id="cb47-8"><a href="#cb47-8"></a>    y=magnetic[<span class="op">-</span><span class="kw">c</span>(i,j)]</span>
<span id="cb47-9"><a href="#cb47-9"></a>    x=chemical[<span class="op">-</span><span class="kw">c</span>(i,j)]</span>
<span id="cb47-10"><a href="#cb47-10"></a>    </span>
<span id="cb47-11"><a href="#cb47-11"></a>    P1=<span class="kw">lm</span>(y<span class="op">~</span>x)</span>
<span id="cb47-12"><a href="#cb47-12"></a>    y1_<span class="dv">1</span>=chemical[i]<span class="op">*</span>P1<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>P1<span class="op">$</span>coef[<span class="dv">1</span>]</span>
<span id="cb47-13"><a href="#cb47-13"></a>    y1_<span class="dv">2</span>=chemical[j]<span class="op">*</span>P1<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>P1<span class="op">$</span>coef[<span class="dv">1</span>]</span>
<span id="cb47-14"><a href="#cb47-14"></a>    e1[p]=(magnetic[i]<span class="op">-</span>y1_<span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span><span class="op">+</span>(magnetic[j]<span class="op">-</span>y1_<span class="dv">2</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb47-15"><a href="#cb47-15"></a>    </span>
<span id="cb47-16"><a href="#cb47-16"></a>    P2=<span class="kw">lm</span>(y<span class="op">~</span>x<span class="op">+</span><span class="kw">I</span>(x<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb47-17"><a href="#cb47-17"></a>    y2_<span class="dv">1</span>=P2<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>P2<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>chemical[i] <span class="op">+</span><span class="st"> </span>P2<span class="op">$</span>coef[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>chemical[i]<span class="op">^</span><span class="dv">2</span></span>
<span id="cb47-18"><a href="#cb47-18"></a>    y2_<span class="dv">2</span>=P2<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>P2<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>chemical[j] <span class="op">+</span><span class="st"> </span>P2<span class="op">$</span>coef[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>chemical[j]<span class="op">^</span><span class="dv">2</span></span>
<span id="cb47-19"><a href="#cb47-19"></a>    e2[p]=(magnetic[i]<span class="op">-</span>y2_<span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span><span class="op">+</span>(magnetic[j]<span class="op">-</span>y2_<span class="dv">2</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb47-20"><a href="#cb47-20"></a>    </span>
<span id="cb47-21"><a href="#cb47-21"></a>    P3=<span class="kw">lm</span>(<span class="kw">log</span>(y)<span class="op">~</span>x)</span>
<span id="cb47-22"><a href="#cb47-22"></a>    y3_<span class="dv">1</span>=<span class="kw">exp</span>(P3<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>P3<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>chemical[i])</span>
<span id="cb47-23"><a href="#cb47-23"></a>    y3_<span class="dv">2</span>=<span class="kw">exp</span>(P3<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>P3<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>chemical[j])</span>
<span id="cb47-24"><a href="#cb47-24"></a>    e3[p]=(magnetic[i]<span class="op">-</span>y3_<span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span><span class="op">+</span>(magnetic[j]<span class="op">-</span>y3_<span class="dv">2</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb47-25"><a href="#cb47-25"></a>    </span>
<span id="cb47-26"><a href="#cb47-26"></a>    P4=<span class="kw">lm</span>(<span class="kw">log</span>(y)<span class="op">~</span><span class="kw">log</span>(x))</span>
<span id="cb47-27"><a href="#cb47-27"></a>    y4_<span class="dv">1</span>=<span class="kw">exp</span>(P4<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>P4<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(chemical[i]))</span>
<span id="cb47-28"><a href="#cb47-28"></a>    y4_<span class="dv">2</span>=<span class="kw">exp</span>(P4<span class="op">$</span>coef[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>P4<span class="op">$</span>coef[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(chemical[j]))</span>
<span id="cb47-29"><a href="#cb47-29"></a>    e4[p]=(magnetic[i]<span class="op">-</span>y4_<span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span><span class="op">+</span>(magnetic[j]<span class="op">-</span>y4_<span class="dv">2</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb47-30"><a href="#cb47-30"></a>  }</span>
<span id="cb47-31"><a href="#cb47-31"></a>e =<span class="st"> </span><span class="kw">c</span>(<span class="kw">mean</span>(e1)<span class="op">/</span><span class="dv">2</span>,<span class="kw">mean</span>(e2)<span class="op">/</span><span class="dv">2</span>,<span class="kw">mean</span>(e3)<span class="op">/</span><span class="dv">2</span>,<span class="kw">mean</span>(e4)<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb47-32"><a href="#cb47-32"></a><span class="kw">matrix</span>(e, <span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="st">&quot;prediction error&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;Linear&quot;</span>,<span class="st">&quot;Quadratic&quot;</span>,<span class="st">&quot; Exponential&quot;</span>,<span class="st">&quot;Log-Log&quot;</span>)))</span></code></pre></div>
<pre><code>##                    Linear Quadratic  Exponential  Log-Log
## prediction error 19.57227  17.87018     18.45491 20.46718</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">detach</span>(ironslag)</span></code></pre></div>
<p>The prediction error is a little bit lagerer than leave-one-out cross validation.<br />
# HOMEWORK 6<br />
## 8.3<br />
The Count 5 test for equal variances in Section 6.4 is based on the maximum number of extreme points. Example 6.15 shows that the Count 5 criterion is not applicable for unequal sample sizes. Implement a permutation test for equal variance based on the maximum number of extreme points that applies when sample sizes are not necessarily equal.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>count5=<span class="cf">function</span>(x1,x2){</span>
<span id="cb50-2"><a href="#cb50-2"></a>  x1=x1<span class="op">-</span><span class="kw">mean</span>(x1)</span>
<span id="cb50-3"><a href="#cb50-3"></a>  x2=x2<span class="op">-</span><span class="kw">mean</span>(x2)</span>
<span id="cb50-4"><a href="#cb50-4"></a>  out1 &lt;-<span class="st"> </span><span class="kw">sum</span>(x1 <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(x2)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(x1 <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(x2))</span>
<span id="cb50-5"><a href="#cb50-5"></a>  out2 &lt;-<span class="st"> </span><span class="kw">sum</span>(x2 <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(x1)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(x2 <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(x1))</span>
<span id="cb50-6"><a href="#cb50-6"></a>  <span class="kw">return</span>(<span class="kw">max</span>(<span class="kw">c</span>(out1, out2)))</span>
<span id="cb50-7"><a href="#cb50-7"></a>}</span>
<span id="cb50-8"><a href="#cb50-8"></a>count5_per=<span class="cf">function</span>(z){</span>
<span id="cb50-9"><a href="#cb50-9"></a>  n=<span class="kw">length</span>(z)</span>
<span id="cb50-10"><a href="#cb50-10"></a>  x=z[<span class="dv">1</span><span class="op">:</span>(n<span class="op">/</span><span class="dv">2</span>)]</span>
<span id="cb50-11"><a href="#cb50-11"></a>  y=z[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span>(n<span class="op">/</span><span class="dv">2</span>))]</span>
<span id="cb50-12"><a href="#cb50-12"></a>  a=<span class="kw">count5</span>(x,y)</span>
<span id="cb50-13"><a href="#cb50-13"></a>  <span class="kw">return</span>(a)</span>
<span id="cb50-14"><a href="#cb50-14"></a>}</span>
<span id="cb50-15"><a href="#cb50-15"></a>per=<span class="cf">function</span>(z,R){</span>
<span id="cb50-16"><a href="#cb50-16"></a>  n=<span class="kw">length</span>(z)</span>
<span id="cb50-17"><a href="#cb50-17"></a>  result=<span class="kw">numeric</span>(R)</span>
<span id="cb50-18"><a href="#cb50-18"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>R){</span>
<span id="cb50-19"><a href="#cb50-19"></a>    q=<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n,n,<span class="dt">replace=</span><span class="ot">FALSE</span>)</span>
<span id="cb50-20"><a href="#cb50-20"></a>    result[i]=<span class="kw">count5_per</span>(z[q])</span>
<span id="cb50-21"><a href="#cb50-21"></a>  }</span>
<span id="cb50-22"><a href="#cb50-22"></a>  <span class="kw">return</span>(<span class="kw">sum</span>(result<span class="op">&gt;</span><span class="dv">5</span>)<span class="op">/</span>R)</span>
<span id="cb50-23"><a href="#cb50-23"></a>}</span>
<span id="cb50-24"><a href="#cb50-24"></a>n1=<span class="dv">20</span></span>
<span id="cb50-25"><a href="#cb50-25"></a>n2=<span class="dv">40</span></span>
<span id="cb50-26"><a href="#cb50-26"></a>mu1=mu2=<span class="dv">0</span></span>
<span id="cb50-27"><a href="#cb50-27"></a>s1=s2=<span class="dv">2</span></span>
<span id="cb50-28"><a href="#cb50-28"></a>R=<span class="fl">1e3</span></span>
<span id="cb50-29"><a href="#cb50-29"></a>test1=test2=<span class="kw">numeric</span>(R)</span>
<span id="cb50-30"><a href="#cb50-30"></a><span class="co">#compare</span></span>
<span id="cb50-31"><a href="#cb50-31"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>R){</span>
<span id="cb50-32"><a href="#cb50-32"></a>  x=<span class="kw">rnorm</span>(n1,mu1,s1)</span>
<span id="cb50-33"><a href="#cb50-33"></a>  y=<span class="kw">rnorm</span>(n2,mu2,s2)</span>
<span id="cb50-34"><a href="#cb50-34"></a>  test1[i]=(<span class="kw">count5</span>(x,y)<span class="op">&gt;</span><span class="dv">5</span>)</span>
<span id="cb50-35"><a href="#cb50-35"></a>  z=<span class="kw">c</span>(x,y)</span>
<span id="cb50-36"><a href="#cb50-36"></a>  test2[i]=<span class="kw">per</span>(z,<span class="dv">500</span>)</span>
<span id="cb50-37"><a href="#cb50-37"></a>}</span>
<span id="cb50-38"><a href="#cb50-38"></a><span class="kw">c</span>(<span class="kw">mean</span>(test1),<span class="kw">mean</span>(test2<span class="op">&lt;</span><span class="fl">0.05</span>))</span></code></pre></div>
<pre><code>## [1] 0.218 0.134</code></pre>
<div id="design-experiments-for-evaluating-the-performance-of-the-nn-energy-and-ball-methods-in-various-situationsnote-the-parameters-should-be-chosen-such-that-the-powers-are-distinguishable-say-range-from-0.3-to-0.8." class="section level3">
<h3>Design experiments for evaluating the performance of the NN, energy, and ball methods in various situations(Note: The parameters should be chosen such that the powers are distinguishable (say, range from 0.3 to 0.8).</h3>
<div id="unequal-variances-and-equal-expectations" class="section level4">
<h4>Unequal variances and equal expectations</h4>
</div>
<div id="unequal-variances-and-unequal-expectations" class="section level4">
<h4>Unequal variances and unequal expectations</h4>
</div>
<div id="non-normal-distributions-t-distribution-with-1-df-heavy-tailed-distribution-bimodel-distribution-mixture-of-two-normal-distributions" class="section level4">
<h4>Non-normal distributions: t distribution with 1 df (heavy-tailed distribution), bimodel distribution (mixture of two normal distributions)</h4>
</div>
<div id="unbalanced-samples-say-1-case-versus-10-controls" class="section level4">
<h4>Unbalanced samples (say, 1 case versus 10 controls)</h4>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">library</span>(RANN)</span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="kw">library</span>(boot)</span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="kw">library</span>(Ball)</span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="kw">library</span>(energy)</span>
<span id="cb52-5"><a href="#cb52-5"></a><span class="kw">library</span>(MASS)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:DAAG&#39;:
## 
##     hills</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co">#NN-methods</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>Tn &lt;-<span class="st"> </span><span class="cf">function</span>(z, ix, sizes,k) {</span>
<span id="cb55-3"><a href="#cb55-3"></a>  n1 &lt;-<span class="st"> </span>sizes[<span class="dv">1</span>]; n2 &lt;-<span class="st"> </span>sizes[<span class="dv">2</span>]; n &lt;-<span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>n2</span>
<span id="cb55-4"><a href="#cb55-4"></a>  <span class="cf">if</span>(<span class="kw">is.vector</span>(z)) z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(z,<span class="dv">0</span>);</span>
<span id="cb55-5"><a href="#cb55-5"></a>  z &lt;-<span class="st"> </span>z[ix, ];</span>
<span id="cb55-6"><a href="#cb55-6"></a>  NN &lt;-<span class="st"> </span><span class="kw">nn2</span>(<span class="dt">data=</span>z, <span class="dt">k=</span>k<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb55-7"><a href="#cb55-7"></a>  block1 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[<span class="dv">1</span><span class="op">:</span>n1,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb55-8"><a href="#cb55-8"></a>  block2 &lt;-<span class="st"> </span>NN<span class="op">$</span>nn.idx[(n1<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>n,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb55-9"><a href="#cb55-9"></a>  i1 &lt;-<span class="st"> </span><span class="kw">sum</span>(block1 <span class="op">&lt;</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="fl">.5</span>); i2 &lt;-<span class="st"> </span><span class="kw">sum</span>(block2 <span class="op">&gt;</span><span class="st"> </span>n1<span class="fl">+.5</span>)</span>
<span id="cb55-10"><a href="#cb55-10"></a>  (i1 <span class="op">+</span><span class="st"> </span>i2) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>n)</span>
<span id="cb55-11"><a href="#cb55-11"></a>}</span>
<span id="cb55-12"><a href="#cb55-12"></a>NN=<span class="cf">function</span>(z,sizes,k){</span>
<span id="cb55-13"><a href="#cb55-13"></a>  boot.obj &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>z,<span class="dt">statistic=</span>Tn,<span class="dt">R=</span>R, <span class="dt">sim =</span> <span class="st">&quot;permutation&quot;</span>, <span class="dt">sizes =</span> sizes,<span class="dt">k=</span>k)</span>
<span id="cb55-14"><a href="#cb55-14"></a>  ts &lt;-<span class="st"> </span><span class="kw">c</span>(boot.obj<span class="op">$</span>t0,boot.obj<span class="op">$</span>t)</span>
<span id="cb55-15"><a href="#cb55-15"></a>  p.value &lt;-<span class="st"> </span><span class="kw">mean</span>(ts<span class="op">&gt;=</span>ts[<span class="dv">1</span>])</span>
<span id="cb55-16"><a href="#cb55-16"></a>  <span class="kw">return</span>(<span class="kw">c</span>(<span class="dt">statistic=</span>ts[<span class="dv">1</span>],<span class="dt">p.value=</span>p.value))</span>
<span id="cb55-17"><a href="#cb55-17"></a>}</span>
<span id="cb55-18"><a href="#cb55-18"></a><span class="co">#energy</span></span>
<span id="cb55-19"><a href="#cb55-19"></a><span class="co"># eqdist.etest in package energy</span></span>
<span id="cb55-20"><a href="#cb55-20"></a><span class="co">#ball</span></span>
<span id="cb55-21"><a href="#cb55-21"></a><span class="co"># bd.test in package Ball</span></span>
<span id="cb55-22"><a href="#cb55-22"></a><span class="co">#settings</span></span>
<span id="cb55-23"><a href="#cb55-23"></a>n1=n2=<span class="dv">20</span></span>
<span id="cb55-24"><a href="#cb55-24"></a>n=n1<span class="op">+</span>n2 </span>
<span id="cb55-25"><a href="#cb55-25"></a>N=<span class="kw">c</span>(n1,n2)</span>
<span id="cb55-26"><a href="#cb55-26"></a>k=<span class="dv">3</span></span>
<span id="cb55-27"><a href="#cb55-27"></a>R=<span class="dv">500</span></span>
<span id="cb55-28"><a href="#cb55-28"></a>m=<span class="dv">100</span></span>
<span id="cb55-29"><a href="#cb55-29"></a>alpha=<span class="fl">0.05</span></span>
<span id="cb55-30"><a href="#cb55-30"></a><span class="co">#compare</span></span>
<span id="cb55-31"><a href="#cb55-31"></a>com=<span class="cf">function</span>(mu1,mu2,s1,s2,alpha){</span>
<span id="cb55-32"><a href="#cb55-32"></a>  p.values=<span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb55-33"><a href="#cb55-33"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb55-34"><a href="#cb55-34"></a>    data1=<span class="kw">mvrnorm</span>(n1,mu1,sigma1)</span>
<span id="cb55-35"><a href="#cb55-35"></a>    data2=<span class="kw">mvrnorm</span>(n2,mu2,sigma2)</span>
<span id="cb55-36"><a href="#cb55-36"></a>    data=<span class="kw">rbind</span>(data1,data2)</span>
<span id="cb55-37"><a href="#cb55-37"></a>    p.values[i,<span class="dv">1</span>]=<span class="kw">NN</span>(data,N,k)[<span class="dv">2</span>]</span>
<span id="cb55-38"><a href="#cb55-38"></a>    p.values[i,<span class="dv">2</span>]=<span class="kw">eqdist.etest</span>(data,<span class="dt">sizes=</span>N,<span class="dt">R=</span>R)<span class="op">$</span>p.value</span>
<span id="cb55-39"><a href="#cb55-39"></a>    p.values[i,<span class="dv">3</span>]=<span class="kw">bd.test</span>(<span class="dt">x=</span>data1,<span class="dt">y=</span>data2,<span class="dt">num.permutations=</span>R,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">2846</span>)<span class="op">$</span>p.value</span>
<span id="cb55-40"><a href="#cb55-40"></a>  }</span>
<span id="cb55-41"><a href="#cb55-41"></a>  p=<span class="kw">colMeans</span>(p.values<span class="op">&lt;</span>alpha)</span>
<span id="cb55-42"><a href="#cb55-42"></a>  <span class="kw">return</span>(p)</span>
<span id="cb55-43"><a href="#cb55-43"></a>}</span>
<span id="cb55-44"><a href="#cb55-44"></a></span>
<span id="cb55-45"><a href="#cb55-45"></a><span class="co">#Unequal variances and equal expectations  </span></span>
<span id="cb55-46"><a href="#cb55-46"></a>mu1=mu2=<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb55-47"><a href="#cb55-47"></a>sigma1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">nrow=</span><span class="dv">3</span>,<span class="dt">ncol=</span><span class="dv">3</span>)</span>
<span id="cb55-48"><a href="#cb55-48"></a>sigma2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>),<span class="dt">nrow=</span><span class="dv">3</span>,<span class="dt">ncol=</span><span class="dv">3</span>)</span>
<span id="cb55-49"><a href="#cb55-49"></a>result1=<span class="kw">com</span>(mu1,mu2,s1,s2,alpha)</span>
<span id="cb55-50"><a href="#cb55-50"></a></span>
<span id="cb55-51"><a href="#cb55-51"></a><span class="co">#Unequal variances and unequal expectations  </span></span>
<span id="cb55-52"><a href="#cb55-52"></a>mu1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb55-53"><a href="#cb55-53"></a>sigma1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">nrow=</span><span class="dv">3</span>,<span class="dt">ncol=</span><span class="dv">3</span>)</span>
<span id="cb55-54"><a href="#cb55-54"></a>mu2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">1</span>)</span>
<span id="cb55-55"><a href="#cb55-55"></a>sigma2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>),<span class="dt">nrow=</span><span class="dv">3</span>,<span class="dt">ncol=</span><span class="dv">3</span>)</span>
<span id="cb55-56"><a href="#cb55-56"></a>result2=<span class="kw">com</span>(mu1,mu2,s1,s2,alpha)</span>
<span id="cb55-57"><a href="#cb55-57"></a></span>
<span id="cb55-58"><a href="#cb55-58"></a><span class="co">#Non-normal distributions</span></span>
<span id="cb55-59"><a href="#cb55-59"></a><span class="co">#t distribution with 1 df (heavy-tailed distribution)</span></span>
<span id="cb55-60"><a href="#cb55-60"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb55-61"><a href="#cb55-61"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb55-62"><a href="#cb55-62"></a>  data1=<span class="kw">rt</span>(n1,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb55-63"><a href="#cb55-63"></a>  data2=<span class="kw">rt</span>(n2,<span class="dv">2</span>,<span class="dv">5</span>)</span>
<span id="cb55-64"><a href="#cb55-64"></a>  data=<span class="kw">c</span>(data1,data2)</span>
<span id="cb55-65"><a href="#cb55-65"></a>  p.values[i,<span class="dv">1</span>]=<span class="kw">NN</span>(data,N,k)[<span class="dv">2</span>]</span>
<span id="cb55-66"><a href="#cb55-66"></a>  p.values[i,<span class="dv">2</span>]=<span class="kw">eqdist.etest</span>(data,<span class="dt">sizes=</span>N,<span class="dt">R=</span>R)<span class="op">$</span>p.value</span>
<span id="cb55-67"><a href="#cb55-67"></a>  p.values[i,<span class="dv">3</span>]=<span class="kw">bd.test</span>(<span class="dt">x=</span>data1,<span class="dt">y=</span>data2,<span class="dt">num.permutations=</span>R,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">2846</span>)<span class="op">$</span>p.value</span>
<span id="cb55-68"><a href="#cb55-68"></a>}</span>
<span id="cb55-69"><a href="#cb55-69"></a>result3=<span class="kw">colMeans</span>(p.values<span class="op">&lt;</span>alpha)</span>
<span id="cb55-70"><a href="#cb55-70"></a><span class="co">#bimodel distribution (mixture of two normal distributions)  </span></span>
<span id="cb55-71"><a href="#cb55-71"></a>bimodel&lt;-<span class="cf">function</span>(n,mu1,mu2,sd1,sd2){</span>
<span id="cb55-72"><a href="#cb55-72"></a>  index=<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,n,<span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb55-73"><a href="#cb55-73"></a>  x=<span class="kw">numeric</span>(n)</span>
<span id="cb55-74"><a href="#cb55-74"></a>  index1&lt;-<span class="kw">which</span>(index<span class="op">==</span><span class="dv">1</span>)</span>
<span id="cb55-75"><a href="#cb55-75"></a>  x[index1]&lt;-<span class="kw">rnorm</span>(<span class="kw">length</span>(index1),mu1,sd1)</span>
<span id="cb55-76"><a href="#cb55-76"></a>  index2&lt;-<span class="kw">which</span>(index<span class="op">==</span><span class="dv">2</span>)</span>
<span id="cb55-77"><a href="#cb55-77"></a>  x[index2]&lt;-<span class="kw">rnorm</span>(<span class="kw">length</span>(index2),mu2,sd2)</span>
<span id="cb55-78"><a href="#cb55-78"></a>  <span class="kw">return</span>(x)</span>
<span id="cb55-79"><a href="#cb55-79"></a>}</span>
<span id="cb55-80"><a href="#cb55-80"></a>p.values &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,m,<span class="dv">3</span>)</span>
<span id="cb55-81"><a href="#cb55-81"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb55-82"><a href="#cb55-82"></a>  data1=<span class="kw">bimodel</span>(n1,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb55-83"><a href="#cb55-83"></a>  data2=<span class="kw">bimodel</span>(n2,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>)</span>
<span id="cb55-84"><a href="#cb55-84"></a>  data=<span class="kw">c</span>(data1,data2)</span>
<span id="cb55-85"><a href="#cb55-85"></a>  p.values[i,<span class="dv">1</span>]=<span class="kw">NN</span>(data,N,k)[<span class="dv">2</span>]</span>
<span id="cb55-86"><a href="#cb55-86"></a>  p.values[i,<span class="dv">2</span>]=<span class="kw">eqdist.etest</span>(data,<span class="dt">sizes=</span>N,<span class="dt">R=</span>R)<span class="op">$</span>p.value</span>
<span id="cb55-87"><a href="#cb55-87"></a>  p.values[i,<span class="dv">3</span>]=<span class="kw">bd.test</span>(<span class="dt">x=</span>data1,<span class="dt">y=</span>data2,<span class="dt">num.permutations=</span>R,<span class="dt">seed=</span>i<span class="op">*</span><span class="dv">2846</span>)<span class="op">$</span>p.value</span>
<span id="cb55-88"><a href="#cb55-88"></a>}</span>
<span id="cb55-89"><a href="#cb55-89"></a>result4=<span class="kw">colMeans</span>(p.values<span class="op">&lt;</span>alpha)</span>
<span id="cb55-90"><a href="#cb55-90"></a></span>
<span id="cb55-91"><a href="#cb55-91"></a><span class="co">#Unbalanced samples (say, 1 case versus 10 controls)</span></span>
<span id="cb55-92"><a href="#cb55-92"></a>n2=<span class="dv">10</span><span class="op">*</span>n1</span>
<span id="cb55-93"><a href="#cb55-93"></a>n=n1<span class="op">+</span>n2 </span>
<span id="cb55-94"><a href="#cb55-94"></a>N=<span class="kw">c</span>(n1,n2)</span>
<span id="cb55-95"><a href="#cb55-95"></a>result5=<span class="kw">com</span>(mu1,mu2,s1,s2,alpha)</span>
<span id="cb55-96"><a href="#cb55-96"></a><span class="kw">rbind</span>(result1,result2,result3,result4,result5)</span></code></pre></div>
<pre><code>##         [,1] [,2] [,3]
## result1 0.33 0.35 0.89
## result2 0.53 0.80 0.91
## result3 0.65 0.56 0.88
## result4 0.54 0.96 0.95
## result5 0.24 0.97 1.00</code></pre>
</div>
</div>
</div>
</div>
<div id="homework-7" class="section level1">
<h1>HOMEWORK 7</h1>
<div id="section-12" class="section level2">
<h2>9.4</h2>
<p>Implement a random walk Metropolis sampler for generating the standard Laplace distribution (see Exercise 3.2). For the increment, simulate from a normal distribution. Compare the chains generated when different variances are used for the proposal distribution. Also, compute the acceptance rates of each chain.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co">#standard Laplace dendity distribution </span></span>
<span id="cb57-2"><a href="#cb57-2"></a>f=<span class="cf">function</span>(x) <span class="fl">0.5</span><span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span><span class="kw">abs</span>(x))</span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co">#random walk</span></span>
<span id="cb57-4"><a href="#cb57-4"></a>Metro=<span class="cf">function</span>(sd,x0,N){</span>
<span id="cb57-5"><a href="#cb57-5"></a>  x=<span class="kw">numeric</span>(N)</span>
<span id="cb57-6"><a href="#cb57-6"></a>  x[<span class="dv">1</span>]=x0</span>
<span id="cb57-7"><a href="#cb57-7"></a>  u=<span class="kw">runif</span>(N)</span>
<span id="cb57-8"><a href="#cb57-8"></a>  p=<span class="dv">0</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>N) {</span>
<span id="cb57-10"><a href="#cb57-10"></a>    y=<span class="kw">rnorm</span>(<span class="dv">1</span>,x[i<span class="dv">-1</span>],sd)</span>
<span id="cb57-11"><a href="#cb57-11"></a>    <span class="cf">if</span>(u[i]<span class="op">&lt;=</span>(<span class="kw">f</span>(y)<span class="op">/</span><span class="kw">f</span>(x[i<span class="dv">-1</span>]))) x[i]=y </span>
<span id="cb57-12"><a href="#cb57-12"></a>    <span class="cf">else</span> {</span>
<span id="cb57-13"><a href="#cb57-13"></a>      x[i]=x[i<span class="dv">-1</span>]</span>
<span id="cb57-14"><a href="#cb57-14"></a>      p=p<span class="op">+</span><span class="dv">1</span></span>
<span id="cb57-15"><a href="#cb57-15"></a>    }</span>
<span id="cb57-16"><a href="#cb57-16"></a>  }</span>
<span id="cb57-17"><a href="#cb57-17"></a>  <span class="kw">return</span>(<span class="kw">c</span>(x,p))</span>
<span id="cb57-18"><a href="#cb57-18"></a>}</span>
<span id="cb57-19"><a href="#cb57-19"></a><span class="co">#compare the chains generated with different variances</span></span>
<span id="cb57-20"><a href="#cb57-20"></a>N=<span class="dv">2000</span></span>
<span id="cb57-21"><a href="#cb57-21"></a>sd=<span class="kw">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>)</span>
<span id="cb57-22"><a href="#cb57-22"></a>x0=<span class="dv">10</span></span>
<span id="cb57-23"><a href="#cb57-23"></a>ch1=<span class="kw">Metro</span>(sd[<span class="dv">1</span>],x0,N)</span>
<span id="cb57-24"><a href="#cb57-24"></a>ch2=<span class="kw">Metro</span>(sd[<span class="dv">2</span>],x0,N)</span>
<span id="cb57-25"><a href="#cb57-25"></a>ch3=<span class="kw">Metro</span>(sd[<span class="dv">3</span>],x0,N)</span>
<span id="cb57-26"><a href="#cb57-26"></a>ch4=<span class="kw">Metro</span>(sd[<span class="dv">4</span>],x0,N)</span>
<span id="cb57-27"><a href="#cb57-27"></a><span class="co">#Compare the chains</span></span>
<span id="cb57-28"><a href="#cb57-28"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb57-29"><a href="#cb57-29"></a>ch=<span class="kw">cbind</span>(ch1[<span class="dv">1</span><span class="op">:</span>N],ch2[<span class="dv">1</span><span class="op">:</span>N],ch3[<span class="dv">1</span><span class="op">:</span>N],ch4[<span class="dv">1</span><span class="op">:</span>N])</span>
<span id="cb57-30"><a href="#cb57-30"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</span>
<span id="cb57-31"><a href="#cb57-31"></a>  <span class="kw">plot</span>(ch[,j], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb57-32"><a href="#cb57-32"></a>  <span class="kw">boxplot</span>(ch[,j])</span>
<span id="cb57-33"><a href="#cb57-33"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAVFBMVEUAAAAAADoAAGYAOpAAZrY6AAA6ADo6kNtmAABmADpmZmZmtrZmtv+QOgCQkGaQ2/+2ZgC2/7a2///T09PbkDrb/9vb////tmb/25D//7b//9v///+TPpNgAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAGz0lEQVR4nO2dC3fiNhBG1c2mybahpS27JPj//8/iB2AZ5DvG8iDgu3t2I0zOzJy7svwSIlRilHDrAkpHggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQImCZotwoN3/5dqJyJONQzSdAmvLWN7aFxFi7J3EJvVc+UwnerYxmbl1/Twi0haGI9kZVFBH29fxya20SndhU0rZ4QvVQPGqYNTQ8K528AE8eg7r9sZJ/PkSdjPadWPPQsI2jfqds0if8vb0GGek6tUPXLW0gQh/MVhJQiiA+fvoIulOMyBlkq88ljxXsM4nBPLegwJI6c3LsKstTTaznsYrsVXfT49iBDPYPW0rvYbvUdwvnuYlzPqeVzFNuGj9H3vccgrKfXHBzUjDzNIC1BkFaHeUgrQZBWgiCtLlYhrXoQpJUgSCtBkFaCIK3uB0FaCaK0oYp9TY+Qg3IFqQdBWp/7QRxOgiBcsYI0BmHa5ScvWMIVLMj2xtW/aAxXsCD1oPG0GoPG03qcB32915NMtunHdM6CLPWcWi5PVt+6qUq9uV2DcO6CoJ5Ty+GOYl1QV0pyRpe3IKrn1HIS9PnaFDSYE3ib6S+WenoFzBmD+tMA0rv0E/egeB9OTRltNX6vDsPjpXC+grieU2vWIG0T1Nb029/pOZNV1Kf7zYUO81hPr7LSbrm6CCJ8B2lLuIIFzdvF3vrjdKrDGsLFgsKxeeeCYjbXf3jmOQRtk/OyOdxTCJpTkARBuLgECToPJ0EQ7uEFbUJ9bnp9QccaHlXQ3IL6grp2COlrtIUpW1B4HEHmi1UOJ0EQrr0obP+09YzeSFuYfIIsN8xM4U6CQlGCSplp33abo6Be4yb000ZFFCQolCIotjU9QpZ1MLpb42UKMr2R/sV1jhVCHlhQ8r73JM69PJCg8Y+mWcMNvISCBM0bg/DTjcZwDyvo8IxybkFnZh5CkOED1tZwjynICp4KOAsy1NP9HNaxjCDDkliugiz1dD//65gjaP3ya+QhbmVc0MhR0IQFlnL0oHWT4+s9fTBLL4nVy+8oyFRPaoM1ydl50Mi9jufuQYdsY49VLUti+Y5B1iW6coxBbbbP17ErDsOSWJ6C7Et0ZRmkP1/DrCcabThXQYZ6up85BOUpqFBB88egXAWVKejsRSGCqtPPvHns9SRelCCokqBL4fo7lQRdCFewINMbV/+iNVw8LEvQWbhYSa8z3QQJwnoSLyToUE+vXcyT1b6gqhhB8enqDQVVZQoanNDfUtDhwWr3WoLicK2MWFD+PPZ6jq0yBXXdSYJO4STIFK4nqJKgC+EkyFBQtFGCzguKNj6FoIlLQUQblxB0l0tT9AqKNi4myF6PjyDzB/krH0ETFhbwEXR5KYhL4XwEmetRD4J6fATVKYxLQbgImlCP02E+sRREOJLKsdBh3l5PKStxpjYWcB50+GfwhjmCmd60HFu4hQUZ6/G7oyhBeQqKN95ckOMYdKeCNAalUvdbOopdSN21/HrQVeFuL6jg86AF8lgZnNn7HMWuCnd7QaU8evbJY2V+PbkFJcmbx6+e3IWH4b+Dw+vdIUGABAESBEgQIEGABAESBEgQcL+VOyFBgAQBEgRIECBBgAQBEgRIECBBgAQBEgRIEJBV0Hb26jHlkVPQtp4u+GiGMgpqp6GscyzoWRAZBbVzumd8c1KR5BT0e713zVgQv0gyCmqHn0cbhCQI0C4GaJAGdJgHdKIIZL3UmPfVW2Wii1VAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAiQIkCBAggAJAvIJOpu28BjzGCQIkCAgq6Cv9z/fQ/N9tvVEmL9qQftGvRJtPe8suWRv0WQWtHey2f9d731sQ/ei/vLfevZZas3nssks6K2ZqtjOVlx3G5p5ndtv//y4yz0us6CPZgH+dqbrfkM7DDW+1uE+Jy8uImhzFNStqPZRfxIo8cUFhePRg2p2qz/uc37wIoK6GdPdhobNy8+RNWkLZhFBzcHreBRrR+uPO52Dv4yg+DxoL2a9P8TvVvc4TOtiFZAgQIIACQIkCJAgQIIACQIkCJAgQIIACQIkCJAgQIIACQIkCJAgQIIACQIkCJAgQIIACQL+B5GzHPFF0/+aAAAAAElFTkSuQmCC" /><!-- --><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co">#acceptance rates</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>R=<span class="kw">c</span>(ch1[N<span class="op">+</span><span class="dv">1</span>],ch2[N<span class="op">+</span><span class="dv">1</span>],ch3[N<span class="op">+</span><span class="dv">1</span>],ch4[N<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb58-3"><a href="#cb58-3"></a>Acc=(N<span class="op">-</span>R)<span class="op">/</span>N</span>
<span id="cb58-4"><a href="#cb58-4"></a>Acc</span></code></pre></div>
<pre><code>## [1] 0.9615 0.6770 0.2810 0.1545</code></pre>
<p>As the variance is increasing, the acceptance rate is decreasing.</p>
</div>
<div id="section-13" class="section level2">
<h2>9.4+</h2>
<p>For Exercise 9.4, use the Gelman-Rubin method to monitor convergence of the chain, and run the chain until it converges approximately to the target distribution according to <span class="math inline">\(\hat{R}&lt;1.2\)</span>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>Gelman.Rubin &lt;-<span class="st"> </span><span class="cf">function</span>(psi) {</span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="co"># psi[i,j] is the statistic psi(X[i,1:j])</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="co"># for chain in i-th row of X</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>  psi &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(psi)</span>
<span id="cb60-5"><a href="#cb60-5"></a>  n &lt;-<span class="st"> </span><span class="kw">ncol</span>(psi)</span>
<span id="cb60-6"><a href="#cb60-6"></a>  k &lt;-<span class="st"> </span><span class="kw">nrow</span>(psi)</span>
<span id="cb60-7"><a href="#cb60-7"></a>  psi.means &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(psi) <span class="co">#row means</span></span>
<span id="cb60-8"><a href="#cb60-8"></a>  B &lt;-<span class="st"> </span>n <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(psi.means) <span class="co">#between variance est.</span></span>
<span id="cb60-9"><a href="#cb60-9"></a>  psi.w &lt;-<span class="st"> </span><span class="kw">apply</span>(psi, <span class="dv">1</span>, <span class="st">&quot;var&quot;</span>) <span class="co">#within variances</span></span>
<span id="cb60-10"><a href="#cb60-10"></a>  W &lt;-<span class="st"> </span><span class="kw">mean</span>(psi.w) <span class="co">#within est.</span></span>
<span id="cb60-11"><a href="#cb60-11"></a>  v.hat &lt;-<span class="st"> </span>W<span class="op">*</span>(n<span class="dv">-1</span>)<span class="op">/</span>n <span class="op">+</span><span class="st"> </span>(B<span class="op">/</span>n) <span class="co">#upper variance est.</span></span>
<span id="cb60-12"><a href="#cb60-12"></a>  r.hat &lt;-<span class="st"> </span>v.hat <span class="op">/</span><span class="st"> </span>W <span class="co">#G-R statistic</span></span>
<span id="cb60-13"><a href="#cb60-13"></a>  <span class="kw">return</span>(r.hat)</span>
<span id="cb60-14"><a href="#cb60-14"></a>}</span>
<span id="cb60-15"><a href="#cb60-15"></a></span>
<span id="cb60-16"><a href="#cb60-16"></a>k=<span class="dv">4</span> <span class="co">#number of chains to generate</span></span>
<span id="cb60-17"><a href="#cb60-17"></a>b=<span class="dv">1000</span> <span class="co">#burn-in length</span></span>
<span id="cb60-18"><a href="#cb60-18"></a>N=<span class="dv">15000</span></span>
<span id="cb60-19"><a href="#cb60-19"></a><span class="co">#choose overdispersed initial values</span></span>
<span id="cb60-20"><a href="#cb60-20"></a>x0 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">-5</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb60-21"><a href="#cb60-21"></a>sd=<span class="kw">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>)</span>
<span id="cb60-22"><a href="#cb60-22"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb60-23"><a href="#cb60-23"></a><span class="cf">for</span>(z <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){</span>
<span id="cb60-24"><a href="#cb60-24"></a> X=<span class="kw">matrix</span>(<span class="dt">nrow=</span>k,<span class="dt">ncol=</span>N)</span>
<span id="cb60-25"><a href="#cb60-25"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k){</span>
<span id="cb60-26"><a href="#cb60-26"></a>   X[i,]=<span class="kw">Metro</span>(sd[z],x0[i],N)[<span class="dv">1</span><span class="op">:</span>N]</span>
<span id="cb60-27"><a href="#cb60-27"></a> }</span>
<span id="cb60-28"><a href="#cb60-28"></a> psi=<span class="kw">t</span>(<span class="kw">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb60-29"><a href="#cb60-29"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(psi))</span>
<span id="cb60-30"><a href="#cb60-30"></a>   psi[i,]=psi[i,]<span class="op">/</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(psi))</span>
<span id="cb60-31"><a href="#cb60-31"></a> rhat=<span class="kw">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb60-32"><a href="#cb60-32"></a> <span class="cf">for</span> (j <span class="cf">in</span> (b<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>N)</span>
<span id="cb60-33"><a href="#cb60-33"></a>   rhat[j]=<span class="kw">Gelman.Rubin</span>(psi[,<span class="dv">1</span><span class="op">:</span>j])</span>
<span id="cb60-34"><a href="#cb60-34"></a> <span class="kw">plot</span>(rhat[(b<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>N], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="kw">paste</span>(<span class="st">&quot;sigma=&quot;</span>,sd[z]), <span class="dt">ylab=</span><span class="st">&quot;R_hat&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="kw">max</span>(<span class="kw">max</span>(rhat[(b<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>N]),<span class="fl">1.4</span>)))</span>
<span id="cb60-35"><a href="#cb60-35"></a> <span class="kw">abline</span>(<span class="dt">h=</span><span class="fl">1.2</span>,<span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb60-36"><a href="#cb60-36"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,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" /><!-- --><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="section-14" class="section level2">
<h2>11.4</h2>
<p>Find the intersection points <span class="math inline">\(A(k)\)</span> in <span class="math inline">\((0,\sqrt{k})\)</span> of the curves <span class="math display">\[S_{k-1}(a)=P(t(k-1)&gt;\sqrt{\frac{a^2(k-1)}{k-a^2}})\]</span> and <span class="math display">\[S_{k}(a)=P(t(k)&gt;\sqrt{\frac{a^2k}{k+1-a^2}}),\]</span> for <span class="math inline">\(k=4:25,100,500,1000\)</span>, where <span class="math inline">\(t(k)\)</span> is a Student t random variable with k degrees of freedom.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>k=<span class="kw">c</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">25</span>,<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">1000</span>)</span>
<span id="cb61-2"><a href="#cb61-2"></a>S=<span class="cf">function</span>(a,k){</span>
<span id="cb61-3"><a href="#cb61-3"></a>  z=<span class="kw">sqrt</span>(a<span class="op">^</span><span class="dv">2</span><span class="op">*</span>k<span class="op">/</span>(k<span class="op">+</span><span class="dv">1</span><span class="op">-</span>a<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb61-4"><a href="#cb61-4"></a>  p=<span class="kw">pt</span>(z,<span class="dt">df=</span>k,<span class="dt">lower.tail=</span><span class="ot">FALSE</span>)</span>
<span id="cb61-5"><a href="#cb61-5"></a>  <span class="kw">return</span>(p)</span>
<span id="cb61-6"><a href="#cb61-6"></a>}</span>
<span id="cb61-7"><a href="#cb61-7"></a>f=<span class="cf">function</span>(a,k){</span>
<span id="cb61-8"><a href="#cb61-8"></a>  <span class="kw">S</span>(a,k)<span class="op">-</span><span class="kw">S</span>(a,k<span class="dv">-1</span>)</span>
<span id="cb61-9"><a href="#cb61-9"></a>}</span>
<span id="cb61-10"><a href="#cb61-10"></a>solve =<span class="st"> </span><span class="cf">function</span>(k){</span>
<span id="cb61-11"><a href="#cb61-11"></a>  out=<span class="kw">uniroot</span>(<span class="cf">function</span>(a){<span class="kw">S</span>(a,k)<span class="op">-</span><span class="kw">S</span>(a,k<span class="dv">-1</span>)},<span class="dt">lower=</span><span class="dv">1</span>,<span class="dt">upper=</span><span class="dv">2</span>)</span>
<span id="cb61-12"><a href="#cb61-12"></a>  <span class="kw">return</span>(out<span class="op">$</span>root)</span>
<span id="cb61-13"><a href="#cb61-13"></a>}</span>
<span id="cb61-14"><a href="#cb61-14"></a>n=<span class="kw">length</span>(k)</span>
<span id="cb61-15"><a href="#cb61-15"></a>A_k=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">ncol=</span>n,<span class="dt">nrow=</span><span class="dv">2</span>)</span>
<span id="cb61-16"><a href="#cb61-16"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){</span>
<span id="cb61-17"><a href="#cb61-17"></a>  A_k[<span class="dv">2</span>,i]=<span class="kw">solve</span>(k[i])</span>
<span id="cb61-18"><a href="#cb61-18"></a>}</span>
<span id="cb61-19"><a href="#cb61-19"></a>A_k[<span class="dv">1</span>,]=k</span>
<span id="cb61-20"><a href="#cb61-20"></a>A_k</span></code></pre></div>
<pre><code>##          [,1]     [,2]     [,3]    [,4]     [,5]     [,6]     [,7]      [,8]
## [1,] 4.000000 5.000000 6.000000 7.00000 8.000000 9.000000 10.00000 11.000000
## [2,] 1.492103 1.533556 1.562744 1.58443 1.601185 1.614521  1.62539  1.634419
##           [,9]     [,10]    [,11]     [,12]     [,13]     [,14]     [,15]
## [1,] 12.000000 13.000000 14.00000 15.000000 16.000000 17.000000 18.000000
## [2,]  1.642038  1.648554  1.65419  1.659114  1.663452  1.667303  1.670745
##         [,16]     [,17]     [,18]     [,19]    [,20]     [,21]     [,22]
## [1,] 19.00000 20.000000 21.000000 22.000000 23.00000 24.000000 25.000000
## [2,]  1.67384  1.676637  1.679178  1.681496  1.68362  1.685572  1.687373
##           [,23]      [,24]       [,25]
## [1,] 100.000000 500.000000 1000.000000
## [2,]   1.720608   1.729755    1.730907</code></pre>
</div>
</div>
<div id="homework-8" class="section level1">
<h1>HOMEWORK 8</h1>
<div id="a-b-o-blood-type-problem" class="section level2">
<h2>A-B-O blood type problem</h2>
<p>Let the three alleles be A,B,and O. <span class="math display">\[\begin{array}{l|l|l|l|l|l|l|l}
\hline \text { Genotype } &amp; \text { AA } &amp; \text { BB } &amp; \text { OO } &amp; \text { AO } &amp; \text { BO } &amp; \text { AB } &amp; \text { Sum } \\
\hline \text { Frequency } &amp; \mathrm{p}^{\wedge} 2 &amp; \mathrm{q}^{\wedge} 2 &amp; \mathrm{r}^{\wedge} 2 &amp; 2 \mathrm{pr} &amp; 2 \mathrm{qr} &amp; 2 \mathrm{pq} &amp; 1 \\
\hline \text { Count } &amp; \mathrm{nAA} &amp; \mathrm{nBB} &amp; \mathrm{nOO} &amp; \mathrm{nAO} &amp; \mathrm{nBO} &amp; \mathrm{nAB} &amp; \mathrm{n} \\
\hline
\end{array}\]</span> Obseved data: <span class="math inline">\(n_A.=n_{AA}+n_{AO}=444\)</span>(A-type),<br />
<span class="math inline">\(n_B.=n_{BB}+n_{BO}=132\)</span>(B-type),<br />
<span class="math inline">\(n_{OO}=361\)</span>(O-type),<br />
<span class="math inline">\(n_{AB}=63\)</span>(AB-type).<br />
1.Use EM algorithm to solve MLE of p and q (consider missing data <span class="math inline">\(n_{AA}\)</span> and <span class="math inline">\(n_{BB}\)</span>).<br />
2.Record the values of p and q that maximize the conditional likelihood in each EM steps, calculate the corresponding log-maximum likelihood values (for observed data), are they increasing?</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="kw">library</span>(nloptr)</span>
<span id="cb63-2"><a href="#cb63-2"></a>eval_f0 =<span class="st"> </span><span class="cf">function</span>(x,x1,<span class="dt">nA=</span><span class="dv">444</span>,<span class="dt">nB=</span><span class="dv">132</span>,<span class="dt">nOO=</span><span class="dv">361</span>,<span class="dt">nAB=</span><span class="dv">63</span>) {</span>
<span id="cb63-3"><a href="#cb63-3"></a>  r1=<span class="dv">1</span><span class="op">-</span><span class="kw">sum</span>(x1)</span>
<span id="cb63-4"><a href="#cb63-4"></a>  nAA=nA<span class="op">*</span>x1[<span class="dv">1</span>]<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(x1[<span class="dv">1</span>]<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">2</span><span class="op">*</span>x1[<span class="dv">1</span>]<span class="op">*</span>r1)</span>
<span id="cb63-5"><a href="#cb63-5"></a>  nBB=nB<span class="op">*</span>x1[<span class="dv">2</span>]<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(x1[<span class="dv">2</span>]<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">2</span><span class="op">*</span>x1[<span class="dv">2</span>]<span class="op">*</span>r1)</span>
<span id="cb63-6"><a href="#cb63-6"></a>  r=<span class="dv">1</span><span class="op">-</span><span class="kw">sum</span>(x)</span>
<span id="cb63-7"><a href="#cb63-7"></a>  <span class="kw">return</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span>nAA<span class="op">*</span><span class="kw">log</span>(x[<span class="dv">1</span>])<span class="op">-</span><span class="dv">2</span><span class="op">*</span>nBB<span class="op">*</span><span class="kw">log</span>(x[<span class="dv">2</span>])<span class="op">-</span><span class="dv">2</span><span class="op">*</span>nOO<span class="op">*</span><span class="kw">log</span>(r)<span class="op">-</span>(nA<span class="op">-</span>nAA)<span class="op">*</span><span class="kw">log</span>(<span class="dv">2</span><span class="op">*</span>x[<span class="dv">1</span>]<span class="op">*</span>r)<span class="op">-</span>(nB<span class="op">-</span>nBB)<span class="op">*</span><span class="kw">log</span>(<span class="dv">2</span><span class="op">*</span>x[<span class="dv">2</span>]<span class="op">*</span>r)<span class="op">-</span>nAB<span class="op">*</span><span class="kw">log</span>(<span class="dv">2</span><span class="op">*</span>x[<span class="dv">1</span>]<span class="op">*</span>x[<span class="dv">2</span>]))</span>
<span id="cb63-8"><a href="#cb63-8"></a>}</span>
<span id="cb63-9"><a href="#cb63-9"></a>eval_g0 =<span class="st"> </span><span class="cf">function</span>(x,x1,<span class="dt">nA=</span><span class="dv">444</span>,<span class="dt">nB=</span><span class="dv">132</span>,<span class="dt">nOO=</span><span class="dv">361</span>,<span class="dt">nAB=</span><span class="dv">63</span>){</span>
<span id="cb63-10"><a href="#cb63-10"></a>  <span class="kw">return</span>(<span class="kw">sum</span>(x)<span class="op">-</span><span class="fl">0.99999</span>)</span>
<span id="cb63-11"><a href="#cb63-11"></a>}</span>
<span id="cb63-12"><a href="#cb63-12"></a>mle=<span class="ot">NULL</span></span>
<span id="cb63-13"><a href="#cb63-13"></a>r=<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="dv">1</span>,<span class="dv">2</span>)<span class="co">#the beginning value of p and q</span></span>
<span id="cb63-14"><a href="#cb63-14"></a>j=<span class="dv">1</span></span>
<span id="cb63-15"><a href="#cb63-15"></a><span class="cf">while</span>(<span class="kw">sum</span>(<span class="kw">abs</span>(r[j,]<span class="op">-</span>r[j<span class="dv">-1</span>,]))<span class="op">&gt;</span><span class="fl">1e-7</span><span class="op">||</span>j<span class="op">&lt;=</span><span class="dv">1</span>){</span>
<span id="cb63-16"><a href="#cb63-16"></a>  res =<span class="st"> </span><span class="kw">nloptr</span>( <span class="dt">x0=</span><span class="kw">c</span>(<span class="fl">0.2</span>,<span class="fl">0.25</span>),<span class="dt">eval_f=</span>eval_f0,<span class="dt">lb =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">ub =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">eval_g_ineq =</span> eval_g0, </span>
<span id="cb63-17"><a href="#cb63-17"></a>                <span class="dt">opts=</span><span class="kw">list</span>(<span class="st">&quot;algorithm&quot;</span>=<span class="st">&quot;NLOPT_LN_COBYLA&quot;</span>,<span class="st">&quot;xtol_rel&quot;</span>=<span class="fl">1.0e-7</span>),<span class="dt">x1=</span>r[j,],<span class="dt">nA=</span><span class="dv">444</span>,<span class="dt">nB=</span><span class="dv">132</span>,<span class="dt">nOO=</span><span class="dv">361</span>,<span class="dt">nAB=</span><span class="dv">63</span>)</span>
<span id="cb63-18"><a href="#cb63-18"></a>  j=j<span class="op">+</span><span class="dv">1</span></span>
<span id="cb63-19"><a href="#cb63-19"></a>  r=<span class="kw">rbind</span>(r,res<span class="op">$</span>solution)</span>
<span id="cb63-20"><a href="#cb63-20"></a>  mle=<span class="kw">c</span>(mle,<span class="kw">eval_f0</span>(<span class="dt">x=</span>r[j,],<span class="dt">x1=</span>r[j<span class="dv">-1</span>,]))</span>
<span id="cb63-21"><a href="#cb63-21"></a>}</span>
<span id="cb63-22"><a href="#cb63-22"></a><span class="co">#results</span></span>
<span id="cb63-23"><a href="#cb63-23"></a>n=<span class="kw">length</span>(r[,<span class="dv">1</span>])</span>
<span id="cb63-24"><a href="#cb63-24"></a>p=r[n,<span class="dv">1</span>]</span>
<span id="cb63-25"><a href="#cb63-25"></a>q=r[n,<span class="dv">2</span>]</span>
<span id="cb63-26"><a href="#cb63-26"></a><span class="kw">list</span>(<span class="st">&quot;results&quot;</span>=<span class="kw">c</span>(p,q),<span class="st">&quot;mle&quot;</span>=<span class="op">-</span>mle,<span class="st">&quot;each step&quot;</span>=r)</span></code></pre></div>
<pre><code>## $results
## [1] 0.2976407 0.1027063
## 
## $mle
##  [1] -1991.102 -1573.554 -1455.089 -1432.665 -1428.611 -1427.878 -1427.745
##  [8] -1427.721 -1427.717 -1427.716 -1427.716
## 
## $`each step`
##            [,1]      [,2]
##  [1,] 0.5000000 0.5000000
##  [2,] 0.4754999 0.1635000
##  [3,] 0.3416511 0.1096863
##  [4,] 0.3062087 0.1034977
##  [5,] 0.2992214 0.1028197
##  [6,] 0.2979287 0.1027251
##  [7,] 0.2976930 0.1027096
##  [8,] 0.2976501 0.1027069
##  [9,] 0.2976424 0.1027064
## [10,] 0.2976410 0.1027063
## [11,] 0.2976407 0.1027063
## [12,] 0.2976407 0.1027063</code></pre>
<p>We can see from the values of mle in the second list that they are increasing.</p>
</div>
<div id="excersice-11.1.2-3" class="section level2">
<h2>Excersice 11.1.2 3</h2>
<p>Use both for loops and lapply() to fit linear models to the mtcars using the formulas stored in this list: formulas &lt;- list( mpg ~ disp, mpg ~ I(1 / disp), mpg ~ disp + wt, mpg ~ I(1 / disp) + wt )</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>formulas =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb65-2"><a href="#cb65-2"></a>  mpg <span class="op">~</span><span class="st"> </span>disp,</span>
<span id="cb65-3"><a href="#cb65-3"></a>  mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>disp),</span>
<span id="cb65-4"><a href="#cb65-4"></a>  mpg <span class="op">~</span><span class="st"> </span>disp <span class="op">+</span><span class="st"> </span>wt,</span>
<span id="cb65-5"><a href="#cb65-5"></a>  mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>disp) <span class="op">+</span><span class="st"> </span>wt</span>
<span id="cb65-6"><a href="#cb65-6"></a>)</span>
<span id="cb65-7"><a href="#cb65-7"></a><span class="kw">attach</span>(mtcars)</span>
<span id="cb65-8"><a href="#cb65-8"></a><span class="co">#loops</span></span>
<span id="cb65-9"><a href="#cb65-9"></a>r=<span class="kw">list</span>()</span>
<span id="cb65-10"><a href="#cb65-10"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">length</span>(formulas)){</span>
<span id="cb65-11"><a href="#cb65-11"></a>  r=<span class="kw">c</span>(r,<span class="kw">list</span>(<span class="kw">lm</span>(formulas[[i]],<span class="dt">data=</span>mtcars)))</span>
<span id="cb65-12"><a href="#cb65-12"></a>}</span>
<span id="cb65-13"><a href="#cb65-13"></a>r</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)           wt  
##      19.024     1142.560       -1.798</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co">#lapply</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>l=<span class="kw">lapply</span>(formulas,<span class="cf">function</span>(x) <span class="kw">lm</span>(<span class="dt">formula=</span>x, <span class="dt">data=</span>mtcars))</span>
<span id="cb67-3"><a href="#cb67-3"></a>l</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = x, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp  
##    29.59985     -0.04122  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = x, data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)  
##       10.75      1557.67  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = x, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp           wt  
##    34.96055     -0.01772     -3.35083  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = x, data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)           wt  
##      19.024     1142.560       -1.798</code></pre>
</div>
<div id="excersice-11.2.5-3" class="section level2">
<h2>Excersice 11.2.5 3</h2>
<p>The following code simulates the performance of a t-test for non-normal data. Use sapply() and an anonymous function to extract the p-value from every trial. trials &lt;- replicate( 100, t.test(rpois(10, 10), rpois(7, 10)), simplify = FALSE )</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>trials =<span class="st"> </span><span class="kw">replicate</span>(</span>
<span id="cb69-2"><a href="#cb69-2"></a>  <span class="dv">100</span>,</span>
<span id="cb69-3"><a href="#cb69-3"></a>  <span class="kw">t.test</span>(<span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="kw">rpois</span>(<span class="dv">7</span>, <span class="dv">10</span>)),</span>
<span id="cb69-4"><a href="#cb69-4"></a>  <span class="dt">simplify =</span> <span class="ot">FALSE</span></span>
<span id="cb69-5"><a href="#cb69-5"></a>)</span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="kw">sapply</span>(trials,<span class="cf">function</span>(x) x[[<span class="st">&quot;p.value&quot;</span>]])</span></code></pre></div>
<pre><code>##   [1] 0.153215606 0.435605222 0.958127450 0.630591608 0.003168570 0.149734745
##   [7] 0.099844666 0.297556646 0.376794868 0.081474709 0.730146321 0.251799932
##  [13] 0.957713894 0.082918436 0.778632438 0.775213597 0.310840787 0.945649375
##  [19] 0.328069804 0.519367925 0.146913224 0.558597285 0.089019946 0.569883457
##  [25] 0.593103157 0.940309240 0.323325168 0.295644480 0.430986583 0.125237195
##  [31] 0.182164684 0.457680176 0.910820198 0.467984070 0.271697753 0.189492305
##  [37] 0.059395211 0.613293487 0.465519954 0.786871647 0.450056484 0.992135531
##  [43] 0.284947474 0.111768039 0.175325089 0.045378954 0.170451996 0.772875617
##  [49] 0.535013073 0.559910210 0.043952501 0.960486018 0.901522582 0.109107841
##  [55] 0.637030259 0.478590139 0.277398993 0.064592125 0.938827642 0.980117332
##  [61] 0.210421240 0.103213024 0.519231906 0.773415152 0.933077779 0.063313594
##  [67] 0.503119743 0.696283694 0.340238311 0.930988791 0.779981598 0.749478422
##  [73] 0.599964862 0.112963915 0.144671504 0.670084117 0.201864114 0.899230723
##  [79] 0.323828615 0.507790608 0.685322335 0.581810367 0.075247061 0.398325030
##  [85] 0.145793591 0.133665687 0.296335828 0.262788771 0.692419864 0.494447721
##  [91] 0.959637335 0.294438399 0.610302698 0.328755814 0.984252507 0.726724833
##  [97] 0.038536374 0.705093171 0.898108958 0.009647915</code></pre>
</div>
<div id="excersice-11.2.5-6" class="section level2">
<h2>Excersice 11.2.5 6</h2>
<p>Implement a combination of Map() and vapply() to create an lapply() variant that iterates in parallel over all of its inputs and stores its outputs in a vector (or a matrix). What arguments should the function take?</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>la=<span class="cf">function</span>(X,FUN,FUN.VALUE){</span>
<span id="cb71-2"><a href="#cb71-2"></a>  re=<span class="kw">Map</span>(<span class="cf">function</span>(x) <span class="kw">vapply</span>(x, FUN, FUN.VALUE), X)</span>
<span id="cb71-3"><a href="#cb71-3"></a>  re=<span class="kw">unlist</span>(re)</span>
<span id="cb71-4"><a href="#cb71-4"></a>  <span class="kw">return</span>(re)</span>
<span id="cb71-5"><a href="#cb71-5"></a>}</span></code></pre></div>
<p>The arguments used are the same as function vapply():<br />
X: a vector (atomic or list) or an expression object.<br />
FUN:the function to be applied to each element of X<br />
FUN.VALUE: a (generalized) vector; a template for the return value from FUN.</p>
</div>
</div>
<div id="homework-9" class="section level1">
<h1>HOMEWORK 9</h1>
<div id="section-15" class="section level2">
<h2>9.4</h2>
<p>1.Write an Rcpp function for 9.4.<br />
2.Compare the corresponding generated random numbers with those by the R function you wrote before using the function “qqplot”.<br />
3.Compare the computation time of the two functions with the function “microbenchmark”.<br />
4.Comments your results.</p>
<p>Rcpp Codes</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co">#include &lt;Rcpp.h&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="co">#include &lt;cmath&gt;</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>using namespace Rcpp;</span>
<span id="cb72-4"><a href="#cb72-4"></a><span class="op">/</span><span class="er">/</span><span class="st"> </span>[[Rcpp<span class="op">::</span>export]]</span>
<span id="cb72-5"><a href="#cb72-5"></a><span class="op">/</span><span class="er">/</span>standard Laplace dendity distribution </span>
<span id="cb72-6"><a href="#cb72-6"></a>float <span class="kw">f</span>(float x){</span>
<span id="cb72-7"><a href="#cb72-7"></a>  a=<span class="fl">0.5</span><span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span><span class="kw">abs</span>(x));</span>
<span id="cb72-8"><a href="#cb72-8"></a>  return a;</span>
<span id="cb72-9"><a href="#cb72-9"></a>}</span>
<span id="cb72-10"><a href="#cb72-10"></a><span class="op">/</span><span class="er">/</span>random walk</span>
<span id="cb72-11"><a href="#cb72-11"></a>NumericVector <span class="kw">Metro</span>(float sd,float x0,int N){</span>
<span id="cb72-12"><a href="#cb72-12"></a>   int x[N<span class="op">+</span><span class="dv">1</span>];</span>
<span id="cb72-13"><a href="#cb72-13"></a>    x[<span class="dv">0</span>]=x0;</span>
<span id="cb72-14"><a href="#cb72-14"></a>    float u[]=<span class="kw">runif</span>(N);</span>
<span id="cb72-15"><a href="#cb72-15"></a>    p=<span class="dv">0</span>;</span>
<span id="cb72-16"><a href="#cb72-16"></a>    <span class="cf">for</span> (int <span class="dt">i=</span><span class="dv">1</span>; i<span class="op">&lt;</span>N;i<span class="op">++</span>) {</span>
<span id="cb72-17"><a href="#cb72-17"></a>      float y[]=<span class="kw">rnorm</span>(<span class="dv">1</span>,x[i<span class="dv">-1</span>],sd);</span>
<span id="cb72-18"><a href="#cb72-18"></a>      <span class="cf">if</span>(u[i]<span class="op">&lt;=</span>(<span class="kw">f</span>(y)<span class="op">/</span><span class="kw">f</span>(x[i<span class="dv">-1</span>]))){</span>
<span id="cb72-19"><a href="#cb72-19"></a>        x[i]=y[<span class="dv">0</span>];</span>
<span id="cb72-20"><a href="#cb72-20"></a>      }</span>
<span id="cb72-21"><a href="#cb72-21"></a>      <span class="cf">else</span> {</span>
<span id="cb72-22"><a href="#cb72-22"></a>          x[i]=x[i<span class="dv">-1</span>];</span>
<span id="cb72-23"><a href="#cb72-23"></a>          p=p<span class="op">+</span><span class="dv">1</span>;</span>
<span id="cb72-24"><a href="#cb72-24"></a>        }</span>
<span id="cb72-25"><a href="#cb72-25"></a>    }</span>
<span id="cb72-26"><a href="#cb72-26"></a>    x[N]=p;</span>
<span id="cb72-27"><a href="#cb72-27"></a>    <span class="kw">return</span>(x);</span>
<span id="cb72-28"><a href="#cb72-28"></a>  }</span></code></pre></div>
<p>Compare<br />
1.Plots</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="kw">library</span>(Rcpp)</span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="co">#C</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>dir_cpp=<span class="st">&#39;C:/Users/Shiru/Desktop/ustc/final/Ruxin/src/&#39;</span></span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="kw">sourceCpp</span>(<span class="kw">paste0</span>(dir_cpp,<span class="st">&quot;CMetro.cpp&quot;</span>))</span>
<span id="cb73-6"><a href="#cb73-6"></a><span class="co">#R</span></span>
<span id="cb73-7"><a href="#cb73-7"></a><span class="co">#standard Laplace dendity distribution </span></span>
<span id="cb73-8"><a href="#cb73-8"></a>f=<span class="cf">function</span>(x) <span class="fl">0.5</span><span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span><span class="kw">abs</span>(x))</span>
<span id="cb73-9"><a href="#cb73-9"></a><span class="co">#random walk</span></span>
<span id="cb73-10"><a href="#cb73-10"></a>Metro=<span class="cf">function</span>(sd,x0,N){</span>
<span id="cb73-11"><a href="#cb73-11"></a>  x=<span class="kw">numeric</span>(N)</span>
<span id="cb73-12"><a href="#cb73-12"></a>  x[<span class="dv">1</span>]=x0</span>
<span id="cb73-13"><a href="#cb73-13"></a>  u=<span class="kw">runif</span>(N)</span>
<span id="cb73-14"><a href="#cb73-14"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>N) {</span>
<span id="cb73-15"><a href="#cb73-15"></a>    y=<span class="kw">rnorm</span>(<span class="dv">1</span>,x[i<span class="dv">-1</span>],sd)</span>
<span id="cb73-16"><a href="#cb73-16"></a>    <span class="cf">if</span>(u[i]<span class="op">&lt;=</span>(<span class="kw">f</span>(y)<span class="op">/</span><span class="kw">f</span>(x[i<span class="dv">-1</span>]))) x[i]=y </span>
<span id="cb73-17"><a href="#cb73-17"></a>    <span class="cf">else</span> {</span>
<span id="cb73-18"><a href="#cb73-18"></a>      x[i]=x[i<span class="dv">-1</span>]</span>
<span id="cb73-19"><a href="#cb73-19"></a>    }</span>
<span id="cb73-20"><a href="#cb73-20"></a>  }</span>
<span id="cb73-21"><a href="#cb73-21"></a>  <span class="kw">return</span>(x)</span>
<span id="cb73-22"><a href="#cb73-22"></a>}</span>
<span id="cb73-23"><a href="#cb73-23"></a>x0=<span class="dv">10</span></span>
<span id="cb73-24"><a href="#cb73-24"></a>N=<span class="dv">3000</span></span>
<span id="cb73-25"><a href="#cb73-25"></a>sd=<span class="dv">1</span></span>
<span id="cb73-26"><a href="#cb73-26"></a>R=<span class="kw">Metro</span>(sd,x0,N)[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>)]</span>
<span id="cb73-27"><a href="#cb73-27"></a>C=<span class="kw">CMetro</span>(sd,x0,N)[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>)]</span>
<span id="cb73-28"><a href="#cb73-28"></a><span class="kw">qqplot</span>(R,C)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>2.Time</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>x0=<span class="dv">10</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>N=<span class="dv">3000</span></span>
<span id="cb74-3"><a href="#cb74-3"></a>sd=<span class="dv">1</span></span>
<span id="cb74-4"><a href="#cb74-4"></a>(<span class="dt">time=</span><span class="kw">microbenchmark</span>(<span class="dt">R=</span><span class="kw">Metro</span>(sd,x0,N),<span class="dt">C=</span><span class="kw">CMetro</span>(sd,x0,N)))</span></code></pre></div>
<pre><code>## Unit: microseconds
##  expr    min      lq     mean median      uq     max neval
##     R 7354.7 7800.15 8643.631 8043.6 8213.95 12824.1   100
##     C  463.1  512.85  537.830  521.4  527.85  1627.3   100</code></pre>
<p>Comments Their results are quite similar. But cpp codes takes significantly less time and improves the efficiency quite a lot.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
